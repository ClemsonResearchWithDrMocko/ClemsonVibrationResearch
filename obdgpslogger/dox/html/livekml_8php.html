<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Logger: livekml/livekml.php File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Logger</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_468e023442c228ba727dd3cd02e2a408.html">livekml</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">livekml.php File Reference</div>  </div>
</div>
<div class="contents">

<p><a href="livekml_8php_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="livekml_8php.html#ab2496e46c9c473c24558f2bce0f6aaf2">stage0</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="livekml_8php.html#a33f875e290bcfa8d18264ecaefa1f696">stage1</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="livekml_8php.html#a446f610966e91698cd197da9c54da905">stage2</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="livekml_8php.html#ab0f09804b8580e6894a708d996556324">$samplelength</a> = 10</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">if(!empty($_REQUEST['samplelength']))&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="livekml_8php.html#a6d159215f4699753b639627ea26bbf00">$targetmpg</a> = 20</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">if(!empty($_REQUEST['targetmpg']))&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="livekml_8php.html#a40ddd4cd946eca51f88706b9b3ce951e">$startdelta</a> = 10</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">if(!empty($_REQUEST['startdelta']))&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="livekml_8php.html#a7ce818fd4b2190cd48d5d3826f02bd04">$updaterate</a> = 4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">if(!empty($_REQUEST['updaterate']))&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="livekml_8php.html#acd56f9fda9af469f6037e157de328449">$dbfilename</a> = &quot;ces2010.db&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">if(!empty($_REQUEST['dbfilename']))&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="livekml_8php.html#a60ff55750f3c569acd2e6cb65dc7745d">$debug</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">if(!empty($_REQUEST['debug'])&amp;&amp;1==$_REQUEST['debug'])&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="livekml_8php.html#ad25f84611a8831342533cbe3c972225f">$styleprefix</a> = &quot;LiveOBDKMLStyle&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="livekml_8php.html#a18d5369215a8f79ab23e0f68b459449e">$stylecount</a> = 2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="livekml_8php.html#ae38afcd5168ac55254b2537553636063">$stage</a> = 0</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ab2496e46c9c473c24558f2bce0f6aaf2"></a><!-- doxytag: member="livekml.php::stage0" ref="ab2496e46c9c473c24558f2bce0f6aaf2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">stage0 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="livekml_8php_source.html#l00083">83</a> of file <a class="el" href="livekml_8php_source.html">livekml.php</a>.</p>
<div class="fragment"><pre class="fragment">                  {
    global <a class="code" href="livekml_8php.html#ab0f09804b8580e6894a708d996556324">$samplelength</a>, <a class="code" href="gauge_8php.html#a66d7a9a7c0b66303709fd22c49490cb0">$startdelta</a>, <a class="code" href="gauge_8php.html#a77f8902dd42fe384e420da22b3180aeb">$dbfilename</a>, <a class="code" href="livekml_8php.html#a6d159215f4699753b639627ea26bbf00">$targetmpg</a>, <a class="code" href="livekml_8php.html#ad25f84611a8831342533cbe3c972225f">$styleprefix</a>;

<span class="preprocessor">    # Yay magic numbers. This is the first time in the ces2010 db</span>
<span class="preprocessor"></span>    $ces2010start = time() - 1262889649;

    print &lt;&lt;&lt; EOF

    &lt;HTML&gt;
    &lt;HEAD&gt;&lt;TITLE&gt;Launch OBDGPSlogger Live&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;
    &lt;H1&gt;Launch OBDGPSlogger Live&lt;/H1&gt;
    &lt;FORM METHOD=<span class="stringliteral">&quot;GET&quot;</span>&gt;
    &lt;INPUT TYPE=<span class="stringliteral">&quot;hidden&quot;</span> NAME=<span class="stringliteral">&quot;stage&quot;</span> VALUE=<span class="stringliteral">&quot;1&quot;</span>&gt;
    &lt;TABLE&gt;
    &lt;TR&gt;&lt;TD&gt;Target MPG&lt;/TD&gt;&lt;TD&gt;&lt;INPUT TYPE=<span class="stringliteral">&quot;text&quot;</span> NAME=<span class="stringliteral">&quot;targetmpg&quot;</span> VALUE=<span class="stringliteral">&quot;$targetmpg&quot;</span>&gt;&lt;/TD&gt;&lt;/TR&gt;
    &lt;TR&gt;&lt;TD&gt;Sample Length (Seconds)&lt;/TD&gt;&lt;TD&gt;&lt;INPUT TYPE=<span class="stringliteral">&quot;text&quot;</span> NAME=<span class="stringliteral">&quot;samplelength&quot;</span> VALUE=<span class="stringliteral">&quot;$samplelength&quot;</span>&gt;&lt;/TD&gt;&lt;/TR&gt;
    &lt;TR&gt;&lt;TD&gt;Start Time&lt;/TD&gt;&lt;TD&gt;
        &lt;SELECT NAME=<span class="stringliteral">&quot;startdelta&quot;</span>&gt;
            &lt;OPTION VALUE=<span class="stringliteral">&quot;-1&quot;</span>&gt;Live Data&lt;/option&gt;
            &lt;OPTION VALUE=<span class="stringliteral">&quot;$ces2010start&quot;</span> SELECTED&gt;Start of ces2010.db&lt;/option&gt;
        &lt;/SELECT&gt;
    &lt;/TD&gt;&lt;/TR&gt;
    &lt;TR&gt;&lt;TD&gt;Update Rate&lt;/TD&gt;&lt;TD&gt;
        &lt;SELECT NAME=<span class="stringliteral">&quot;updaterate&quot;</span>&gt;
            &lt;OPTION VALUE=<span class="stringliteral">&quot;-1&quot;</span>&gt;Never&lt;/option&gt;
            &lt;OPTION VALUE=<span class="stringliteral">&quot;1&quot;</span> SELECTED&gt;1 Second&lt;/option&gt;
            &lt;OPTION VALUE=<span class="stringliteral">&quot;2&quot;</span>&gt;2 Seconds&lt;/option&gt;
            &lt;OPTION VALUE=<span class="stringliteral">&quot;4&quot;</span>&gt;4 Seconds&lt;/option&gt;
            &lt;OPTION VALUE=<span class="stringliteral">&quot;8&quot;</span>&gt;8 Seconds&lt;/option&gt;
            &lt;OPTION VALUE=<span class="stringliteral">&quot;16&quot;</span>&gt;16 Seconds&lt;/option&gt;
            &lt;OPTION VALUE=<span class="stringliteral">&quot;32&quot;</span>&gt;32 Seconds&lt;/option&gt;
        &lt;/SELECT&gt;
    &lt;/TD&gt;&lt;/TR&gt;
    &lt;TR&gt;&lt;TD&gt;DB File&lt;/TD&gt;&lt;TD&gt;&lt;INPUT TYPE=<span class="stringliteral">&quot;text&quot;</span> NAME=<span class="stringliteral">&quot;dbfilename&quot;</span> VALUE=<span class="stringliteral">&quot;$dbfilename&quot;</span>&gt;&lt;/TD&gt;&lt;/TR&gt;
    &lt;TR&gt;&lt;TD&gt;Debug Mode&lt;/TD&gt;&lt;TD&gt;&lt;input type=<span class="stringliteral">&quot;checkbox&quot;</span> name=<span class="stringliteral">&quot;debug&quot;</span> value=<span class="stringliteral">&quot;1&quot;</span> /&gt;&lt;/TD&gt;&lt;/TR&gt;
    &lt;TR&gt;&lt;TD&gt;&lt;INPUT TYPE=<span class="stringliteral">&quot;Submit&quot;</span>&gt;&lt;/TD&gt;&lt;/TR&gt;
    &lt;/FORM&gt;
EOF;

    print &lt;&lt;&lt; EOF

    &lt;/BODY&gt;&lt;/HTML&gt;
EOF;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a33f875e290bcfa8d18264ecaefa1f696"></a><!-- doxytag: member="livekml.php::stage1" ref="a33f875e290bcfa8d18264ecaefa1f696" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">stage1 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="livekml_8php_source.html#l00129">129</a> of file <a class="el" href="livekml_8php_source.html">livekml.php</a>.</p>
<div class="fragment"><pre class="fragment">                  {
    global <a class="code" href="livekml_8php.html#ab0f09804b8580e6894a708d996556324">$samplelength</a>, <a class="code" href="gauge_8php.html#a66d7a9a7c0b66303709fd22c49490cb0">$startdelta</a>, <a class="code" href="gauge_8php.html#a77f8902dd42fe384e420da22b3180aeb">$dbfilename</a>, <a class="code" href="livekml_8php.html#a7ce818fd4b2190cd48d5d3826f02bd04">$updaterate</a>, <a class="code" href="livekml_8php.html#a6d159215f4699753b639627ea26bbf00">$targetmpg</a>, <a class="code" href="livekml_8php.html#ad25f84611a8831342533cbe3c972225f">$styleprefix</a>;

    global <a class="code" href="livekml_8php.html#a60ff55750f3c569acd2e6cb65dc7745d">$debug</a>;
    <span class="keywordflow">if</span>($debug) {
        header(<span class="stringliteral">&#39;Content-type: text/plain&#39;</span>);
    } <span class="keywordflow">else</span> {
        header(<span class="stringliteral">&#39;Content-type: application/vnd.google-earth.kml+xml&#39;</span>);
        header(<span class="stringliteral">&#39;Content-Disposition: attachment; filename=liveobdseed.kml&#39;</span>);
    }

    $url = <span class="stringliteral">&quot;http://&quot;</span> . $_SERVER[<span class="stringliteral">&#39;SERVER_NAME&#39;</span>] . filter_var($_SERVER[<span class="stringliteral">&#39;PHP_SELF&#39;</span>], FILTER_SANITIZE_STRING) .
        <span class="stringliteral">&quot;?startdelta=$startdelta&quot;</span> . <span class="stringliteral">&quot;&amp;&quot;</span> .
        <span class="stringliteral">&quot;samplelength=$samplelength&quot;</span> . <span class="stringliteral">&quot;&amp;&quot;</span> .
        <span class="stringliteral">&quot;dbfilename=$dbfilename&quot;</span> . <span class="stringliteral">&quot;&amp;&quot;</span> .
        <span class="stringliteral">&quot;targetmpg=$targetmpg&quot;</span> . <span class="stringliteral">&quot;&amp;&quot;</span> .
        <span class="stringliteral">&quot;debug=$debug&quot;</span> . <span class="stringliteral">&quot;&amp;&quot;</span> .
        <span class="stringliteral">&quot;stage=2&quot;</span>;

    print &lt;&lt;&lt; EOF
    &lt;kml xmlns=<span class="stringliteral">&quot;http://www.opengis.net/kml/2.2&quot;</span>&gt;
        &lt;NetworkLink&gt;
                &lt;name&gt;OBDGPSLogger network link&lt;/name&gt;
                &lt;description&gt;Showing live data from OBDGPSLogger, pulled from logfile $dbfilename&lt;/description&gt;
                &lt;Link&gt;
                &lt;href&gt;&lt;![CDATA[
                $url
                ]]&gt;&lt;/href&gt;
EOF;

    <span class="keywordflow">if</span>($updaterate &gt; 0) {
        print &lt;&lt;&lt; EOF
                    &lt;refreshMode&gt;onInterval&lt;/refreshMode&gt;
                    &lt;refreshInterval&gt;$updaterate&lt;/refreshInterval&gt;
EOF;
    }
    print &lt;&lt;&lt; EOF
            &lt;/Link&gt;
        &lt;/NetworkLink&gt;
    &lt;/kml&gt;
EOF;
    exit(0);

}
</pre></div>
</div>
</div>
<a class="anchor" id="a446f610966e91698cd197da9c54da905"></a><!-- doxytag: member="livekml.php::stage2" ref="a446f610966e91698cd197da9c54da905" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">stage2 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="livekml_8php_source.html#l00175">175</a> of file <a class="el" href="livekml_8php_source.html">livekml.php</a>.</p>
<div class="fragment"><pre class="fragment">                  {
    global <a class="code" href="livekml_8php.html#ab0f09804b8580e6894a708d996556324">$samplelength</a>, <a class="code" href="gauge_8php.html#a66d7a9a7c0b66303709fd22c49490cb0">$startdelta</a>, <a class="code" href="gauge_8php.html#a77f8902dd42fe384e420da22b3180aeb">$dbfilename</a>, <a class="code" href="livekml_8php.html#a6d159215f4699753b639627ea26bbf00">$targetmpg</a>, <a class="code" href="livekml_8php.html#ad25f84611a8831342533cbe3c972225f">$styleprefix</a>, <a class="code" href="livekml_8php.html#a18d5369215a8f79ab23e0f68b459449e">$stylecount</a>;

    global <a class="code" href="livekml_8php.html#a60ff55750f3c569acd2e6cb65dc7745d">$debug</a>;

    <a class="code" href="gauge_8php.html#a2647bc90b37a6e9c8f6cb7a64eb810f3">$db</a> = <span class="keyword">new</span> PDO(<span class="stringliteral">&quot;sqlite:$dbfilename&quot;</span>);
    <span class="keywordflow">if</span>(!<a class="code" href="gauge_8php.html#a2647bc90b37a6e9c8f6cb7a64eb810f3">$db</a>) {
        print(<span class="stringliteral">&quot;Error opening database $dbfilename\n&quot;</span>);
        exit(1);
    }


    <a class="code" href="gauge_8php.html#a047170d6020a882807665812a27e2525">$sql</a> = <span class="stringliteral">&quot;SELECT gps.lat AS lat,gps.lon AS lon,obd.vss AS vss,(7.107 * obd.vss/obd.maf) AS mpg &quot;</span> .
        <span class="stringliteral">&quot;FROM gps LEFT JOIN obd ON gps.time=obd.time &quot;</span> .
        <span class="stringliteral">&quot;WHERE gps.time &gt;= :starttime &quot;</span> .
        <span class="stringliteral">&quot;AND gps.time &lt;= :endtime&quot;</span>;

    <a class="code" href="gauge_8php.html#af27a9140d5f2658693e7fd107f716449">$stmt</a> = <a class="code" href="gauge_8php.html#a2647bc90b37a6e9c8f6cb7a64eb810f3">$db</a>-&gt;prepare(<a class="code" href="gauge_8php.html#a047170d6020a882807665812a27e2525">$sql</a>);
    <span class="keywordflow">if</span>(!<a class="code" href="gauge_8php.html#af27a9140d5f2658693e7fd107f716449">$stmt</a>) {
        header(<span class="stringliteral">&quot;Content-type: text/plain&quot;</span>);
        print(<span class="stringliteral">&quot;Couldn&#39;t prepare statement\n$sql\n&quot;</span>);
        print_r(<a class="code" href="gauge_8php.html#a2647bc90b37a6e9c8f6cb7a64eb810f3">$db</a>-&gt;errorInfo());
        exit(1);
    }

    <a class="code" href="gauge_8php.html#a8b0e084710cc57553154f5d658e1fef7">$starttime</a> = time() - <a class="code" href="gauge_8php.html#a66d7a9a7c0b66303709fd22c49490cb0">$startdelta</a>;
    $endtime = <a class="code" href="gauge_8php.html#a8b0e084710cc57553154f5d658e1fef7">$starttime</a> + <a class="code" href="livekml_8php.html#ab0f09804b8580e6894a708d996556324">$samplelength</a>;
    <a class="code" href="gauge_8php.html#af27a9140d5f2658693e7fd107f716449">$stmt</a>-&gt;execute(array(<span class="stringliteral">&#39;:starttime&#39;</span> =&gt; <a class="code" href="gauge_8php.html#a8b0e084710cc57553154f5d658e1fef7">$starttime</a>, <span class="stringliteral">&#39;:endtime&#39;</span> =&gt; $endtime));
    

    <span class="comment">// Creates the Document.</span>
    $dom = <span class="keyword">new</span> DOMDocument(<span class="stringliteral">&#39;1.0&#39;</span>, <span class="stringliteral">&#39;UTF-8&#39;</span>);

    <span class="comment">// Creates the root KML element and appends it to the root document.</span>
    $node = $dom-&gt;createElementNS(<span class="stringliteral">&#39;http://earth.google.com/kml/2.2&#39;</span>, <span class="stringliteral">&#39;kml&#39;</span>);
    $parNode = $dom-&gt;appendChild($node);

    <span class="comment">// Creates a KML Document element and append it to the KML element.</span>
    $dnode = $dom-&gt;createElement(<span class="stringliteral">&#39;Document&#39;</span>);
    $dnode-&gt;setAttribute(<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;livegpspos&#39;</span>);
    $docNode = $parNode-&gt;appendChild($dnode);

    $docNameNode = $dom-&gt;createElement(<span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;OBDGPSLogger live updates&#39;</span>);
    $dnode-&gt;appendChild($docNameNode);

    $docStyleNode = $dom-&gt;createElement(<span class="stringliteral">&#39;Style&#39;</span>);
    $docStyleNode-&gt;setAttribute(<span class="stringliteral">&#39;id&#39;</span>, <span class="stringliteral">&#39;hidechildren&#39;</span>);
    $dnode-&gt;appendChild($docStyleNode);

    $listStyleNode = $dom-&gt;createElement(<span class="stringliteral">&#39;ListStyle&#39;</span>);
    $docStyleNode-&gt;appendChild($listStyleNode);

    $hideChildNode = $dom-&gt;createElement(<span class="stringliteral">&#39;listItemType&#39;</span>, <span class="stringliteral">&#39;checkHideChildren&#39;</span>);
    $listStyleNode-&gt;appendChild($hideChildNode);
    $gaugesnode = $dom-&gt;createElement(<span class="stringliteral">&#39;Folder&#39;</span>);
    $nameNode = $dom-&gt;createElement(<span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&#39;Gauges&#39;</span>);
    $gaugesnode-&gt;appendChild($nameNode);
    $dnode-&gt;appendChild($gaugesnode);

    <span class="comment">// All the gauges</span>
    $gaugedelta = time() - $endtime;
    <a class="code" href="seedgauge_8php.html#a0f8ff2ceb1d0a09cfe4111380ea03a2b">seedGaugeKML</a>($dom, $gaugesnode, $endtime, $debug, $gaugedelta, $dbfilename, <span class="stringliteral">&quot;vss&quot;</span>, <span class="stringliteral">&quot;Vehicle Speed&quot;</span>, 0, 255, 0, 1, 0, 1);
    <a class="code" href="seedgauge_8php.html#a0f8ff2ceb1d0a09cfe4111380ea03a2b">seedGaugeKML</a>($dom, $gaugesnode, $endtime, $debug, $gaugedelta, $dbfilename, <span class="stringliteral">&quot;rpm&quot;</span>, <span class="stringliteral">&quot;RPM&quot;</span>, 0, 8000, 0, 0.8, 0, 0.8);
    <a class="code" href="seedgauge_8php.html#a0f8ff2ceb1d0a09cfe4111380ea03a2b">seedGaugeKML</a>($dom, $gaugesnode, $endtime, $debug, $gaugedelta, $dbfilename, <span class="stringliteral">&quot;throttlepos&quot;</span>, <span class="stringliteral">&quot;Throttle Position&quot;</span>, 0, 100, 0, 0.6, 0, 0.6);


    <span class="comment">// Human friendly name for the trace</span>
    $plotNode = $dom-&gt;createElement(<span class="stringliteral">&#39;Folder&#39;</span>);
    $dnode-&gt;appendChild($plotNode);

    <span class="comment">// Set up the styles we need</span>
    <a class="code" href="styles_8php.html#a4afdea1eb7bfa97d5b24d26134619b49">planStyles</a>($stylecount, $styleprefix, $dom, $plotNode);

    $nameNode = $dom-&gt;createElement(<span class="stringliteral">&#39;name&#39;</span>, <span class="stringliteral">&quot;Height=&gt;speed, color=&gt;mpg&quot;</span>);
    $plotNode-&gt;appendChild($nameNode);

    $plotStyleNode = $dom-&gt;createElement(<span class="stringliteral">&#39;styleUrl&#39;</span>, <span class="stringliteral">&#39;hidechildren&#39;</span>);
    $plotNode-&gt;appendChild($plotStyleNode);


    $coorStr = <span class="stringliteral">&quot;&quot;</span>;
    $mpg = -1;
    $currstyle = <span class="stringliteral">&quot;&quot;</span>;
    $laststyle = <span class="stringliteral">&quot;&quot;</span>;
    $lastlon = $lastlat = 0;
    <span class="keywordflow">while</span>(<span class="keyword">false</span> != ($row = <a class="code" href="gauge_8php.html#af27a9140d5f2658693e7fd107f716449">$stmt</a>-&gt;fetch(PDO::FETCH_ASSOC))) {
        <span class="keywordflow">if</span>($lastlon == $row[<span class="stringliteral">&#39;lon&#39;</span>] &amp;&amp; $lastlat == $row[<span class="stringliteral">&#39;lat&#39;</span>]) {
            <span class="keywordflow">continue</span>;
        }
        $lastlon = $row[<span class="stringliteral">&#39;lon&#39;</span>];
        $lastlat = $row[<span class="stringliteral">&#39;lat&#39;</span>];


        <span class="comment">// Creates a coordinates element and gives it the value of the lng and lat columns from the results.</span>
        $coorStr .= $row[<span class="stringliteral">&#39;lon&#39;</span>] . <span class="charliteral">&#39;,&#39;</span> . $row[<span class="stringliteral">&#39;lat&#39;</span>] . <span class="charliteral">&#39;,&#39;</span> . $row[<span class="stringliteral">&#39;vss&#39;</span>] . <span class="stringliteral">&quot;\n&quot;</span>;

        $mpg = $row[<span class="stringliteral">&#39;mpg&#39;</span>];

<span class="preprocessor">        # print $mpg . &quot;\n&quot;;</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span>($mpg &gt;= $targetmpg) {
            $currstyle = $styleprefix . <span class="stringliteral">&#39;Green&#39;</span>;
        } <span class="keywordflow">else</span> {
            $currstyle = $styleprefix . <span class="stringliteral">&#39;Red&#39;</span>;
        }

        <span class="keywordflow">if</span>($laststyle != $currstyle &amp;&amp; <span class="stringliteral">&quot;&quot;</span> != $currstyle) {
            <a class="code" href="styles_8php.html#ae535e9b48981d5d6832b6d01bcac3bce">renderLineString</a>($dom, $plotNode, $coorStr, $laststyle);
            $coorStr = $row[<span class="stringliteral">&#39;lon&#39;</span>] . <span class="charliteral">&#39;,&#39;</span> . $row[<span class="stringliteral">&#39;lat&#39;</span>] . <span class="charliteral">&#39;,&#39;</span> . $row[<span class="stringliteral">&#39;vss&#39;</span>] . <span class="stringliteral">&quot;\n&quot;</span>;
        }
        $laststyle = $currstyle;
    }
    <a class="code" href="styles_8php.html#ae535e9b48981d5d6832b6d01bcac3bce">renderLineString</a>($dom, $plotNode, $coorStr, $currstyle);

    <span class="keywordflow">if</span>($debug) {
        header(<span class="stringliteral">&#39;Content-type: text/plain&#39;</span>);
    } <span class="keywordflow">else</span> {
        header(<span class="stringliteral">&#39;Content-type: application/vnd.google-earth.kml+xml&#39;</span>);
        header(<span class="stringliteral">&#39;Content-Disposition: attachment; filename=liveobd.kml&#39;</span>);
    }

    $kmlOutput = $dom-&gt;saveXML();
    echo $kmlOutput;
}

<a class="code" href="livekml_8php.html#ae38afcd5168ac55254b2537553636063">$stage</a> = 0;
<span class="keywordflow">if</span>(!empty($_REQUEST[<span class="stringliteral">&#39;stage&#39;</span>])) {
    <a class="code" href="livekml_8php.html#ae38afcd5168ac55254b2537553636063">$stage</a> = (int)$_REQUEST[<span class="stringliteral">&#39;stage&#39;</span>];
}

<span class="keywordflow">switch</span>(<a class="code" href="livekml_8php.html#ae38afcd5168ac55254b2537553636063">$stage</a>) {
    <span class="keywordflow">case</span> 1:
        <a class="code" href="livekml_8php.html#a33f875e290bcfa8d18264ecaefa1f696">stage1</a>();
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> 2:
        <a class="code" href="livekml_8php.html#a446f610966e91698cd197da9c54da905">stage2</a>();
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> 0:
    <span class="keywordflow">default</span>:
        <a class="code" href="livekml_8php.html#ab2496e46c9c473c24558f2bce0f6aaf2">stage0</a>();
        <span class="keywordflow">break</span>;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="livekml_8php_a446f610966e91698cd197da9c54da905_cgraph.png" border="0" usemap="#livekml_8php_a446f610966e91698cd197da9c54da905_cgraph" alt=""/></div>
<map name="livekml_8php_a446f610966e91698cd197da9c54da905_cgraph" id="livekml_8php_a446f610966e91698cd197da9c54da905_cgraph">
<area shape="rect" id="node3" href="styles_8php.html#a4afdea1eb7bfa97d5b24d26134619b49" title="planStyles" alt="" coords="132,5,215,35"/><area shape="rect" id="node5" href="styles_8php.html#ae535e9b48981d5d6832b6d01bcac3bce" title="renderLineString" alt="" coords="116,58,231,89"/><area shape="rect" id="node7" href="seedgauge_8php.html#a0f8ff2ceb1d0a09cfe4111380ea03a2b" title="seedGaugeKML" alt="" coords="116,111,231,142"/></map>
</div>
</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="acd56f9fda9af469f6037e157de328449"></a><!-- doxytag: member="livekml.php::$dbfilename" ref="acd56f9fda9af469f6037e157de328449" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">if (!empty($_REQUEST['updaterate'])) $dbfilename = &quot;ces2010.db&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="livekml_8php_source.html#l00065">65</a> of file <a class="el" href="livekml_8php_source.html">livekml.php</a>.</p>

</div>
</div>
<a class="anchor" id="a60ff55750f3c569acd2e6cb65dc7745d"></a><!-- doxytag: member="livekml.php::$debug" ref="a60ff55750f3c569acd2e6cb65dc7745d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">if (!empty($_REQUEST['dbfilename'])) $debug = 0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="livekml_8php_source.html#l00071">71</a> of file <a class="el" href="livekml_8php_source.html">livekml.php</a>.</p>

</div>
</div>
<a class="anchor" id="ab0f09804b8580e6894a708d996556324"></a><!-- doxytag: member="livekml.php::$samplelength" ref="ab0f09804b8580e6894a708d996556324" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">$samplelength = 10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="livekml_8php_source.html#l00036">36</a> of file <a class="el" href="livekml_8php_source.html">livekml.php</a>.</p>

</div>
</div>
<a class="anchor" id="ae38afcd5168ac55254b2537553636063"></a><!-- doxytag: member="livekml.php::$stage" ref="ae38afcd5168ac55254b2537553636063" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">$stage = 0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="livekml_8php_source.html#l00299">299</a> of file <a class="el" href="livekml_8php_source.html">livekml.php</a>.</p>

</div>
</div>
<a class="anchor" id="a40ddd4cd946eca51f88706b9b3ce951e"></a><!-- doxytag: member="livekml.php::$startdelta" ref="a40ddd4cd946eca51f88706b9b3ce951e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">if (!empty($_REQUEST['targetmpg'])) $startdelta = 10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="livekml_8php_source.html#l00048">48</a> of file <a class="el" href="livekml_8php_source.html">livekml.php</a>.</p>

</div>
</div>
<a class="anchor" id="a18d5369215a8f79ab23e0f68b459449e"></a><!-- doxytag: member="livekml.php::$stylecount" ref="a18d5369215a8f79ab23e0f68b459449e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">$stylecount = 2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="livekml_8php_source.html#l00080">80</a> of file <a class="el" href="livekml_8php_source.html">livekml.php</a>.</p>

</div>
</div>
<a class="anchor" id="ad25f84611a8831342533cbe3c972225f"></a><!-- doxytag: member="livekml.php::$styleprefix" ref="ad25f84611a8831342533cbe3c972225f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">if (!empty($_REQUEST['debug'])&amp;&amp;1==$_REQUEST['debug']) $styleprefix = &quot;LiveOBDKMLStyle&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="livekml_8php_source.html#l00077">77</a> of file <a class="el" href="livekml_8php_source.html">livekml.php</a>.</p>

</div>
</div>
<a class="anchor" id="a6d159215f4699753b639627ea26bbf00"></a><!-- doxytag: member="livekml.php::$targetmpg" ref="a6d159215f4699753b639627ea26bbf00" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">if (!empty($_REQUEST['samplelength'])) $targetmpg = 20</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="livekml_8php_source.html#l00042">42</a> of file <a class="el" href="livekml_8php_source.html">livekml.php</a>.</p>

</div>
</div>
<a class="anchor" id="a7ce818fd4b2190cd48d5d3826f02bd04"></a><!-- doxytag: member="livekml.php::$updaterate" ref="a7ce818fd4b2190cd48d5d3826f02bd04" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">if (!empty($_REQUEST['startdelta'])) $updaterate = 4</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="livekml_8php_source.html#l00059">59</a> of file <a class="el" href="livekml_8php_source.html">livekml.php</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Apr 8 2012 21:46:29 for Logger by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
