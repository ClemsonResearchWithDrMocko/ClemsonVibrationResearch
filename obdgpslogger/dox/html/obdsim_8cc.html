<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Logger: sim/obdsim.cc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Logger</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_453d41f79cf1573f43ad5952de0f0538.html">sim</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">obdsim.cc File Reference</div>  </div>
</div>
<div class="contents">

<p>OBD Simulator Main Entrypoint.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;getopt.h&gt;</code><br/>
<code>#include &quot;obdconfig.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="obdservicecommands_8h_source.html">obdservicecommands.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="obdsim_8h_source.html">obdsim.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="simport_8h_source.html">simport.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="datasource_8h_source.html">datasource.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="mainloop_8h_source.html">mainloop.h</a>&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for obdsim.cc:</div>
<div class="dyncontent">
<div class="center"><img src="obdsim_8cc__incl.png" border="0" usemap="#sim_2obdsim_8cc" alt=""/></div>
<map name="sim_2obdsim_8cc" id="sim_2obdsim_8cc">
<area shape="rect" id="node15" href="obdservicecommands_8h.html" title="list of OBD service commands" alt="" coords="7,246,167,277"/><area shape="rect" id="node20" href="obdsim_8h.html" title="OBD Simulator Main Entrypoint." alt="" coords="247,166,321,197"/><area shape="rect" id="node25" href="simport_8h.html" title="Tools to open the sim port." alt="" coords="823,86,897,117"/><area shape="rect" id="node27" href="datasource_8h.html" title="Data generators need to implement the functions defined herein." alt="" coords="921,86,1017,117"/><area shape="rect" id="node29" href="mainloop_8h.html" title="OBD Simulator Main Loop." alt="" coords="241,86,327,117"/><area shape="rect" id="node18" href="obdconvertfunctions_8h.html" title="Functions to convert from OBD output to actual values Functions declared in this file are named by th..." alt="" coords="5,326,155,357"/></map>
</div>
</div>
<p><a href="obdsim_8cc_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1e">simport_type</a> { <a class="el" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea31546da48f30fbf4034a8839ef9e8b1a">SIMPORT_DEFAULT</a>, 
<a class="el" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea8eda7f1b0e59cbb55957a5b68df39b63">SIMPORT_SERIAL</a>, 
<a class="el" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea907b04e1c2997ecfa00cbf520aa1856c">SIMPORT_BLUETOOTH</a>, 
<a class="el" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea5871ad435798cb0526adb06a3c1bd6dd">SIMPORT_SOCKET</a>
 }</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Types of sim ports.  <a href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1e">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#a1fe4a2896c7cb031178c170c3645ecb8">obdsim_initialiseecu</a> (struct <a class="el" href="structobdgen__ecu.html">obdgen_ecu</a> *e)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Default sim generator for windows users is the gui.  <a href="#a1fe4a2896c7cb031178c170c3645ecb8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#a1841e9bf638907641fb2745f4d63aa4d">obdsim_initialisesimsettings</a> (struct <a class="el" href="structsimsettings.html">simsettings</a> *s)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialse all variables in a simsettings.  <a href="#a1841e9bf638907641fb2745f4d63aa4d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#a312e77640a7dced86271f8afd3919342">obdsim_elmreset</a> (struct <a class="el" href="structsimsettings.html">simsettings</a> *s)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Do an elm reset [ATZ or similar].  <a href="#a312e77640a7dced86271f8afd3919342"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#aece73156637283e1b9da36d6f38d7f3e">ecudelay_order</a> (struct <a class="el" href="structsimsettings.html">simsettings</a> *ss)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a sorted list for the ECUs to respond in, based on their delays.  <a href="#aece73156637283e1b9da36d6f38d7f3e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structobdsim__generator.html">obdsim_generator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#a8ec063a8765a65d2d426c7a921ec4709">find_generator</a> (const char *gen_name)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the generator of the given name.  <a href="#a8ec063a8765a65d2d426c7a921ec4709"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#a91cb6a1e4a66445106f1c62b1bec114b">show_genhelp</a> (struct <a class="el" href="structobdsim__generator.html">obdsim_generator</a> *gen)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Print the long description provided by the generator.  <a href="#a91cb6a1e4a66445106f1c62b1bec114b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#a70e2dd9d98c065680177b32e6c31e460">printgenerator</a> (int verbose)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Print the genrators this was linked with.  <a href="#a70e2dd9d98c065680177b32e6c31e460"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#ad44d5c5f3cd4edd3fa2428b2b1989817">set_obdprotocol</a> (const char *prot, struct <a class="el" href="structsimsettings.html">simsettings</a> *ss)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Given a protocol [A]{0-9}, set the protocol in the struct.  <a href="#ad44d5c5f3cd4edd3fa2428b2b1989817"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structobdiiprotocol.html">obdiiprotocol</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#ae06d636c0fff4bc4d72b642fb832011a">find_obdprotocol</a> (const char *protocol_num)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Given the single char, find the protocol for it.  <a href="#ae06d636c0fff4bc4d72b642fb832011a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#aad6f83147b5881b56d147e6ee8803e47">printhelp</a> (const char *argv0)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Print Help for --help.  <a href="#aad6f83147b5881b56d147e6ee8803e47"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#a246ce0006add3670842eac6712fb40b1">printversion</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Print the version string.  <a href="#a246ce0006add3670842eac6712fb40b1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#a736325befc39d947b3600a83ba4512c8">printobdprotocols</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Print all protocol info to stdout.  <a href="#a736325befc39d947b3600a83ba4512c8"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structobdsim__generator.html">obdsim_generator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdsim_8cc.html#ab952efb1bb7b17e33003cd38731b69ea">available_generators</a> []</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">A list of all available generators in this build.  <a href="#ab952efb1bb7b17e33003cd38731b69ea"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>OBD Simulator Main Entrypoint. </p>

<p>Definition in file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
</div><hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="ab6b66e12ac855be3da8b94b1d8825c1e"></a><!-- doxytag: member="obdsim.cc::simport_type" ref="ab6b66e12ac855be3da8b94b1d8825c1e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1e">simport_type</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Types of sim ports. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ab6b66e12ac855be3da8b94b1d8825c1ea31546da48f30fbf4034a8839ef9e8b1a"></a><!-- doxytag: member="SIMPORT_DEFAULT" ref="ab6b66e12ac855be3da8b94b1d8825c1ea31546da48f30fbf4034a8839ef9e8b1a" args="" -->SIMPORT_DEFAULT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ab6b66e12ac855be3da8b94b1d8825c1ea8eda7f1b0e59cbb55957a5b68df39b63"></a><!-- doxytag: member="SIMPORT_SERIAL" ref="ab6b66e12ac855be3da8b94b1d8825c1ea8eda7f1b0e59cbb55957a5b68df39b63" args="" -->SIMPORT_SERIAL</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ab6b66e12ac855be3da8b94b1d8825c1ea907b04e1c2997ecfa00cbf520aa1856c"></a><!-- doxytag: member="SIMPORT_BLUETOOTH" ref="ab6b66e12ac855be3da8b94b1d8825c1ea907b04e1c2997ecfa00cbf520aa1856c" args="" -->SIMPORT_BLUETOOTH</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ab6b66e12ac855be3da8b94b1d8825c1ea5871ad435798cb0526adb06a3c1bd6dd"></a><!-- doxytag: member="SIMPORT_SOCKET" ref="ab6b66e12ac855be3da8b94b1d8825c1ea5871ad435798cb0526adb06a3c1bd6dd" args="" -->SIMPORT_SOCKET</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00234">234</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                  {
    <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea31546da48f30fbf4034a8839ef9e8b1a">SIMPORT_DEFAULT</a>,
    <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea8eda7f1b0e59cbb55957a5b68df39b63">SIMPORT_SERIAL</a>,
    <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea907b04e1c2997ecfa00cbf520aa1856c">SIMPORT_BLUETOOTH</a>,
    <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea5871ad435798cb0526adb06a3c1bd6dd">SIMPORT_SOCKET</a>
};
</pre></div>
</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aece73156637283e1b9da36d6f38d7f3e"></a><!-- doxytag: member="obdsim.cc::ecudelay_order" ref="aece73156637283e1b9da36d6f38d7f3e" args="(struct simsettings *ss)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ecudelay_order </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsimsettings.html">simsettings</a> *&#160;</td>
          <td class="paramname"><em>ss</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a sorted list for the ECUs to respond in, based on their delays. </p>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00176">176</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                            {
    <span class="keywordtype">int</span> i, j;
    <span class="keywordflow">for</span>(i=0;i&lt;ss-&gt;<a class="code" href="structsimsettings.html#acdb4747bd4a5667e6093600988ff33c2">ecu_count</a>;i++) {
        ss-&gt;<a class="code" href="structsimsettings.html#aa4983134adb95a1ea96e74b570184c2b">ecudelays</a>[i].<a class="code" href="structobdgen__ecudelays.html#aed28500a4775cbbf813b0a9de84eb841">ecu</a> = &amp;ss-&gt;<a class="code" href="structsimsettings.html#a59c88da427815ecd7d98ff4c5439f02a">ecus</a>[i];
        ss-&gt;<a class="code" href="structsimsettings.html#aa4983134adb95a1ea96e74b570184c2b">ecudelays</a>[i].<a class="code" href="structobdgen__ecudelays.html#a547ac7ebb179a80a00dc4d251d163da6">delay</a> = ss-&gt;<a class="code" href="structsimsettings.html#a59c88da427815ecd7d98ff4c5439f02a">ecus</a>[i].<a class="code" href="structobdgen__ecu.html#a01de03442118006704e9b57b0dbeefe2">customdelay</a>;
    }

    <span class="comment">/* OH THE HORROR. BUBBLESORT [on the plus side, you only do it</span>
<span class="comment">         once, and you&#39;re only sorting six items]. Plus I haven&#39;t</span>
<span class="comment">         implemented a bubble sort in years and kinda felt like doing it. */</span>
    <span class="keywordflow">for</span>(i=0;i&lt;ss-&gt;<a class="code" href="structsimsettings.html#acdb4747bd4a5667e6093600988ff33c2">ecu_count</a>;i++) {
        <span class="keywordflow">for</span>(j=i+1;j&lt;ss-&gt;<a class="code" href="structsimsettings.html#acdb4747bd4a5667e6093600988ff33c2">ecu_count</a>;j++) {
            <span class="keywordflow">if</span>(ss-&gt;<a class="code" href="structsimsettings.html#aa4983134adb95a1ea96e74b570184c2b">ecudelays</a>[i].<a class="code" href="structobdgen__ecudelays.html#a547ac7ebb179a80a00dc4d251d163da6">delay</a> &gt; ss-&gt;<a class="code" href="structsimsettings.html#aa4983134adb95a1ea96e74b570184c2b">ecudelays</a>[j].<a class="code" href="structobdgen__ecudelays.html#a547ac7ebb179a80a00dc4d251d163da6">delay</a>) {
                <span class="keyword">struct </span><a class="code" href="structobdgen__ecudelays.html" title="This is used for customdelays.">obdgen_ecudelays</a> tmp;
                memcpy(&amp;tmp,&amp;ss-&gt;<a class="code" href="structsimsettings.html#aa4983134adb95a1ea96e74b570184c2b">ecudelays</a>[i],<span class="keyword">sizeof</span>(tmp));
                memcpy(&amp;ss-&gt;<a class="code" href="structsimsettings.html#aa4983134adb95a1ea96e74b570184c2b">ecudelays</a>[i],&amp;ss-&gt;<a class="code" href="structsimsettings.html#aa4983134adb95a1ea96e74b570184c2b">ecudelays</a>[j],<span class="keyword">sizeof</span>(tmp));
                memcpy(&amp;ss-&gt;<a class="code" href="structsimsettings.html#aa4983134adb95a1ea96e74b570184c2b">ecudelays</a>[j],&amp;tmp,<span class="keyword">sizeof</span>(tmp));
            }
        }
    }

    <span class="comment">/* for(i=0;i&lt;ss-&gt;ecu_count;i++) {</span>
<span class="comment">        printf(&quot;ecudelay %i, num %i, delay %i\n&quot;, i,</span>
<span class="comment">            ss-&gt;ecudelays[i].ecu-&gt;ecu_num, ss-&gt;ecudelays[i].delay);</span>
<span class="comment">    } */</span>

    <span class="comment">// Now go through and convert all the delays to delta since the last one</span>
    <span class="keywordflow">for</span>(i=ss-&gt;<a class="code" href="structsimsettings.html#acdb4747bd4a5667e6093600988ff33c2">ecu_count</a>-1;i&gt;0;i--) {
        ss-&gt;<a class="code" href="structsimsettings.html#aa4983134adb95a1ea96e74b570184c2b">ecudelays</a>[i].<a class="code" href="structobdgen__ecudelays.html#a547ac7ebb179a80a00dc4d251d163da6">delay</a> -= ss-&gt;<a class="code" href="structsimsettings.html#aa4983134adb95a1ea96e74b570184c2b">ecudelays</a>[i-1].<a class="code" href="structobdgen__ecudelays.html#a547ac7ebb179a80a00dc4d251d163da6">delay</a>;
    }

    <span class="comment">/* for(i=0;i&lt;ss-&gt;ecu_count;i++) {</span>
<span class="comment">        printf(&quot;ecudelay delta %i, num %i, delay %i\n&quot;, i,</span>
<span class="comment">            ss-&gt;ecudelays[i].ecu-&gt;ecu_num, ss-&gt;ecudelays[i].delay);</span>
<span class="comment">    } */</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8ec063a8765a65d2d426c7a921ec4709"></a><!-- doxytag: member="obdsim.cc::find_generator" ref="a8ec063a8765a65d2d426c7a921ec4709" args="(const char *gen_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structobdsim__generator.html">obdsim_generator</a> * find_generator </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>gen_name</em></td><td>)</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find the generator of the given name. </p>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00665">665</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                                                     {
    <span class="keywordtype">size_t</span> i;
    <span class="keywordflow">if</span>(NULL == gen_name) <span class="keywordflow">return</span> NULL;

    <span class="keywordflow">for</span>(i=0; i&lt;<span class="keyword">sizeof</span>(<a class="code" href="obdsim_8cc.html#ab952efb1bb7b17e33003cd38731b69ea" title="A list of all available generators in this build.">available_generators</a>)/<span class="keyword">sizeof</span>(<a class="code" href="obdsim_8cc.html#ab952efb1bb7b17e33003cd38731b69ea" title="A list of all available generators in this build.">available_generators</a>[0]); i++) {
        <span class="keywordflow">if</span>(0 == strcmp(gen_name, <a class="code" href="obdsim_8cc.html#ab952efb1bb7b17e33003cd38731b69ea" title="A list of all available generators in this build.">available_generators</a>[i]-&gt;name())) {
            <span class="keywordflow">return</span> <a class="code" href="obdsim_8cc.html#ab952efb1bb7b17e33003cd38731b69ea" title="A list of all available generators in this build.">available_generators</a>[i];
        }
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae06d636c0fff4bc4d72b642fb832011a"></a><!-- doxytag: member="obdsim.cc::find_obdprotocol" ref="ae06d636c0fff4bc4d72b642fb832011a" args="(const char *protocol_num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structobdiiprotocol.html">obdiiprotocol</a>* find_obdprotocol </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>protocol_num</em></td><td>)</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Given the single char, find the protocol for it. </p>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00713">713</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                                                 {
    <span class="keywordtype">int</span> i;
    <span class="keywordflow">for</span>(i=0; i&lt;<span class="keyword">sizeof</span>(<a class="code" href="obdsim_8h.html#ae7bdb4a8033475d61f57ff336481cd56" title="All the protocols I know or care about.">obdprotocols</a>)/<span class="keyword">sizeof</span>(<a class="code" href="obdsim_8h.html#ae7bdb4a8033475d61f57ff336481cd56" title="All the protocols I know or care about.">obdprotocols</a>[0]); i++) {
        <span class="keywordflow">if</span>(*protocol_num == <a class="code" href="obdsim_8h.html#ae7bdb4a8033475d61f57ff336481cd56" title="All the protocols I know or care about.">obdprotocols</a>[i].protocol_num) {
            <span class="keywordflow">return</span> &amp;(<a class="code" href="obdsim_8h.html#ae7bdb4a8033475d61f57ff336481cd56" title="All the protocols I know or care about.">obdprotocols</a>[i]);
        }
    }
    <span class="keywordflow">return</span> NULL;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3c04138a5bfe5d72780bb7e82a18e627"></a><!-- doxytag: member="obdsim.cc::main" ref="a3c04138a5bfe5d72780bb7e82a18e627" args="(int argc, char **argv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00241">241</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                {
    <span class="comment">// The &quot;seed&quot; passed in. Generator-specific</span>
    <span class="keywordtype">char</span> *seedstr = NULL;

    <span class="comment">// Type of connection user wants</span>
    <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1e" title="Types of sim ports.">simport_type</a> simport_requested = <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea31546da48f30fbf4034a8839ef9e8b1a">SIMPORT_DEFAULT</a>;

<span class="preprocessor">#ifdef OBDPLATFORM_POSIX</span>
<span class="preprocessor"></span>    <span class="comment">// Whether to launch obdgpslogger attached to this sim</span>
    <span class="keywordtype">int</span> launch_logger = 0;

    <span class="comment">// Whether to launch a terminal attached to this sim if possible</span>
    <span class="keywordtype">int</span> launch_terminal = 0;

    <span class="comment">// If you should open a real device instead of a pty</span>
    <span class="keywordtype">char</span> *tty_device = NULL;
<span class="preprocessor">#endif //OBDPLATFORM_POSIX</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef HAVE_SOCKET</span>
<span class="preprocessor"></span>    <span class="comment">// Set if they wanted a socket connection</span>
    <span class="keywordtype">int</span> socket_port = 0;
<span class="preprocessor">#endif //HAVE_SOCKET</span>
<span class="preprocessor"></span>
    <span class="comment">// Store all settings in here</span>
    <span class="keyword">struct </span><a class="code" href="structsimsettings.html" title="All of the settings relating to the sim go into this.">simsettings</a> ss;
    <a class="code" href="obdsim_8cc.html#a1841e9bf638907641fb2745f4d63aa4d" title="Initialse all variables in a simsettings.">obdsim_initialisesimsettings</a>(&amp;ss);

    <span class="comment">// Logfilen name</span>
    <span class="keywordtype">char</span> *logfile_name = NULL;
    
<span class="preprocessor">#ifdef OBDPLATFORM_WINDOWS</span>
<span class="preprocessor"></span>    <span class="comment">// Windows port to open</span>
    <span class="keywordtype">char</span> *winport = NULL;
<span class="preprocessor">#endif //OBDPLATFORM_WINDOWS</span>
<span class="preprocessor"></span>    
    <span class="comment">// Iterator/index into ecus</span>
    <span class="keywordtype">int</span> current_ecu = 0;

    <span class="keywordtype">int</span> optc;
    <span class="keywordtype">int</span> mustexit = 0;
    <span class="keywordflow">while</span> ((optc = getopt_long (argc, argv, <a class="code" href="ftdipty_8h.html#a303248fd97c4b5fb3413bdcf99f9429d" title="getopt() short options">shortopts</a>, <a class="code" href="ftdipty_8h.html#a94965649155359a4c4eb047af782bf22" title="getopt() long options">longopts</a>, NULL)) != -1) {
        <span class="keywordflow">switch</span> (optc) {
            <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:
                <a class="code" href="boxwhisker_8c.html#aad6f83147b5881b56d147e6ee8803e47" title="Print help.">printhelp</a>(argv[0]);
                <a class="code" href="obdsim_8cc.html#a70e2dd9d98c065680177b32e6c31e460" title="Print the genrators this was linked with.">printgenerator</a>(1);
                mustexit = 1;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>: {
                <span class="keyword">struct </span><a class="code" href="structobdsim__generator.html" title="Declare a generator by building one of these structs.">obdsim_generator</a> *h_gen = <a class="code" href="obdsim_8cc.html#a8ec063a8765a65d2d426c7a921ec4709" title="Find the generator of the given name.">find_generator</a>(optarg);
                <a class="code" href="obdsim_8cc.html#a91cb6a1e4a66445106f1c62b1bec114b" title="Print the long description provided by the generator.">show_genhelp</a>(h_gen);
                mustexit = 1;
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">case</span> <span class="charliteral">&#39;L&#39;</span>:
                <a class="code" href="obdsim_8cc.html#a736325befc39d947b3600a83ba4512c8" title="Print all protocol info to stdout.">printobdprotocols</a>();
                mustexit = 1;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:
                <span class="keywordflow">if</span>(0 != <a class="code" href="obdsim_8cc.html#ad44d5c5f3cd4edd3fa2428b2b1989817" title="Given a protocol [A]{0-9}, set the protocol in the struct.">set_obdprotocol</a>(optarg, &amp;ss)) {
                    printf(<span class="stringliteral">&quot;Couldn&#39;t find protocol \&quot;%s\&quot;, exiting\n&quot;</span>, optarg);
                    mustexit = 1;
                }
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:
                <a class="code" href="obdsim_8cc.html#a70e2dd9d98c065680177b32e6c31e460" title="Print the genrators this was linked with.">printgenerator</a>(0);
                mustexit = 1;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:
                ss.benchmark = atoi(optarg);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:
                <span class="keywordflow">if</span>(NULL != ss.elm_version) {
                    free(ss.elm_version);
                }
                ss.elm_version = strdup(optarg);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>:
                <span class="keywordflow">if</span>(NULL != ss.elm_device) {
                    free(ss.elm_device);
                }
                ss.elm_device = strdup(optarg);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:
                <a class="code" href="ftdipty_8c.html#a246ce0006add3670842eac6712fb40b1" title="Print the version string.">printversion</a>();
                mustexit = 1;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>:
                <span class="keywordflow">if</span>(<a class="code" href="obdsim_8h.html#a5b0dbd8e6a7ad6c03b3394ce73887a57" title="Hardcode maximum number of ECUs/generators.">OBDSIM_MAXECUS</a> &lt;= current_ecu) {
                    fprintf(stderr, <span class="stringliteral">&quot;Only support %i ECUs in this build\n&quot;</span>, <a class="code" href="obdsim_8h.html#a5b0dbd8e6a7ad6c03b3394ce73887a57" title="Hardcode maximum number of ECUs/generators.">OBDSIM_MAXECUS</a>);
                    mustexit = 1;
                } <span class="keywordflow">else</span> {
                    ss.ecus[current_ecu].simgen = <a class="code" href="obdsim_8cc.html#a8ec063a8765a65d2d426c7a921ec4709" title="Find the generator of the given name.">find_generator</a>(optarg);
                    ss.ecus[current_ecu].ecu_num = current_ecu;
                    <span class="keywordflow">if</span>(NULL == ss.ecus[current_ecu].simgen) {
                        fprintf(stderr, <span class="stringliteral">&quot;Couldn&#39;t find generator \&quot;%s\&quot;\n&quot;</span>, optarg);
                        mustexit = 1;
                    }
                    current_ecu++;
                }
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:
                <span class="keywordflow">if</span>(current_ecu == 0) {
                    fprintf(stderr, <span class="stringliteral">&quot;The seed must come after the generator\n&quot;</span>);
                    mustexit=1;
                }
                <span class="keywordflow">if</span>(NULL != ss.ecus[current_ecu-1].seed) {
                    fprintf(stderr, <span class="stringliteral">&quot;Already provided a seed for generator %i\n&quot;</span>, current_ecu);
                    mustexit=1;
                }
                ss.ecus[current_ecu-1].seed = strdup(optarg);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:
                <span class="keywordflow">if</span>(current_ecu == 0) {
                    fprintf(stderr, <span class="stringliteral">&quot;The custom delay must come after the generator\n&quot;</span>);
                    mustexit=1;
                }
                <span class="keywordflow">if</span>(0 != ss.ecus[current_ecu-1].customdelay) {
                    fprintf(stderr, <span class="stringliteral">&quot;Already provided a delay for generator %i\n&quot;</span>, current_ecu);
                    mustexit=1;
                }
                ss.ecus[current_ecu-1].customdelay = atoi(optarg);
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>:
                <span class="keywordflow">if</span>(NULL != logfile_name) {
                    fprintf(stderr, <span class="stringliteral">&quot;Warning! Multiple logs specified. Only last one will be used\n&quot;</span>);
                    free(seedstr);
                }
                logfile_name = strdup(optarg);
                <span class="keywordflow">break</span>;
<span class="preprocessor">#ifdef HAVE_BLUETOOTH</span>
<span class="preprocessor"></span>            <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:
                simport_requested = <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea907b04e1c2997ecfa00cbf520aa1856c">SIMPORT_BLUETOOTH</a>;
                <span class="keywordflow">break</span>;
<span class="preprocessor">#endif //HAVE_BLUETOOTH</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SOCKET</span>
<span class="preprocessor"></span>            <span class="keywordflow">case</span> <span class="charliteral">&#39;k&#39;</span>:
                simport_requested = <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea5871ad435798cb0526adb06a3c1bd6dd">SIMPORT_SOCKET</a>;
                socket_port = atoi(optarg);
                <span class="keywordflow">break</span>;
<span class="preprocessor">#endif //HAVE_SOCKET</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef OBDPLATFORM_POSIX</span>
<span class="preprocessor"></span>            <span class="keywordflow">case</span> <span class="charliteral">&#39;o&#39;</span>:
                launch_logger = 1;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:
                launch_terminal = 1;
                <span class="keywordflow">break</span>;
            <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:
                <span class="keywordflow">if</span>(NULL != tty_device) {
                    free(tty_device);
                }
                tty_device = strdup(optarg);
                <span class="keywordflow">break</span>;
<span class="preprocessor">#endif //OBDPLATFORM_POSIX</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef OBDPLATFORM_WINDOWS</span>
<span class="preprocessor"></span>            <span class="keywordflow">case</span> <span class="charliteral">&#39;w&#39;</span>:
                <span class="keywordflow">if</span>(NULL != winport) {
                    fprintf(stderr, <span class="stringliteral">&quot;Warning! Multiple com port specified. Only last one will be used\n&quot;</span>);
                    free(winport);
                }
                winport = strdup(optarg);
                <span class="keywordflow">break</span>;
<span class="preprocessor">#endif //OBDPLATFORM_WINDOWS</span>
<span class="preprocessor"></span>            <span class="keywordflow">default</span>:
                mustexit = 1;
                <span class="keywordflow">break</span>;
        }
    }

    ss.ecu_count = current_ecu;

    <span class="keywordflow">if</span>(NULL == ss.e_protocol) {
        fprintf(stderr, <span class="stringliteral">&quot;Couldn&#39;t find initial protocol %s\n&quot;</span>, <a class="code" href="obdsim_8h.html#ae975e6f8036c6830fc90d16868f7f9e6" title="Default protocol. Looked up early on - better match something from the above list.">OBDSIM_DEFAULT_PROTOCOLNUM</a>);
        <span class="keywordflow">return</span> 1;
    }

<span class="preprocessor">#ifdef OBDPLATFORM_POSIX</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span>(launch_logger &amp;&amp; launch_terminal) {
        fprintf(stderr, <span class="stringliteral">&quot;Error: Cannot attach terminal and logger to same instance\n&quot;</span>);
        mustexit = 1;
    }
<span class="preprocessor">#endif // OBDPLATFORM_POSIX</span>
<span class="preprocessor"></span>
    <span class="keywordflow">if</span>(0 == ss.ecu_count) {
        ss.ecus[0].ecu_num = 0;
        ss.ecus[0].simgen = <a class="code" href="obdsim_8cc.html#a8ec063a8765a65d2d426c7a921ec4709" title="Find the generator of the given name.">find_generator</a>(<a class="code" href="obdsim_8h.html#aabfadf7f11899ab21341f981b267cfc9" title="Default sim generator.">DEFAULT_SIMGEN</a>);
        <span class="keywordflow">if</span>(NULL == ss.ecus[0].simgen) {
            fprintf(stderr, <span class="stringliteral">&quot;Couldn&#39;t find default generator \&quot;%s\&quot;\n&quot;</span>, <a class="code" href="obdsim_8h.html#aabfadf7f11899ab21341f981b267cfc9" title="Default sim generator.">DEFAULT_SIMGEN</a>);
            mustexit = 1;
        }
        ss.ecu_count++;
    }

    <span class="keywordflow">if</span>(mustexit) <span class="keywordflow">return</span> 0;

    
    <span class="keywordtype">int</span> initialisation_errors = 0;
    <span class="keywordtype">int</span> i;
    <span class="keywordflow">for</span>(i=0;i&lt;ss.ecu_count;i++) {
        <span class="keywordflow">if</span>(0 != ss.ecus[i].simgen-&gt;create(&amp;ss.ecus[i].dg, ss.ecus[i].seed)) {
            fprintf(stderr,<span class="stringliteral">&quot;Couldn&#39;t initialise generator \&quot;%s\&quot; using seed \&quot;%s\&quot;\n&quot;</span>,
                            ss.ecus[i].simgen-&gt;name(), ss.ecus[i].seed);
            initialisation_errors++;
        }
    }
    <span class="keywordflow">if</span>(initialisation_errors &gt; 0) {
        <span class="keywordflow">return</span> 1;
    }

    <span class="comment">/* Getting here means all the ECUs are up and running. Now alter</span>
<span class="comment">        the order they&#39;re queried in based on customdelay */</span>
    <a class="code" href="obdsim_8cc.html#aece73156637283e1b9da36d6f38d7f3e" title="Create a sorted list for the ECUs to respond in, based on their delays.">ecudelay_order</a>(&amp;ss);

    <span class="comment">// The sim port</span>
    <a class="code" href="classOBDSimPort.html" title="Base class for virtual ports.">OBDSimPort</a> *sp = NULL;

    <span class="keywordflow">switch</span>(simport_requested) {
<span class="preprocessor">#ifdef HAVE_SOCKET</span>
<span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea5871ad435798cb0526adb06a3c1bd6dd">SIMPORT_SOCKET</a>:
            sp = <span class="keyword">new</span> SocketSimPort(socket_port);
            <span class="keywordflow">break</span>;
<span class="preprocessor">#endif // HAVE_SOCKET</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_BLUETOOTH</span>
<span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea907b04e1c2997ecfa00cbf520aa1856c">SIMPORT_BLUETOOTH</a>:
            sp = <span class="keyword">new</span> BluetoothSimPort();
            <span class="keywordflow">break</span>;
<span class="preprocessor">#endif // HAVE_BLUETOOTH</span>
<span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea31546da48f30fbf4034a8839ef9e8b1a">SIMPORT_DEFAULT</a>:
        <span class="keywordflow">case</span> <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea8eda7f1b0e59cbb55957a5b68df39b63">SIMPORT_SERIAL</a>:
        <span class="keywordflow">default</span>:
<span class="preprocessor">#ifdef OBDPLATFORM_POSIX</span>
<span class="preprocessor"></span>            sp = <span class="keyword">new</span> <a class="code" href="classPosixSimPort.html" title="Base class for virtual ports.">PosixSimPort</a>(tty_device);
<span class="preprocessor">#endif //OBDPLATFORM_POSIX</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef OBDPLATFORM_WINDOWS</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span>(NULL == winport) {
                winport = strdup(<a class="code" href="obdsim_8h.html#ae866d7f223fbf23e4c0e1329747110c8" title="Default windows port.">DEFAULT_WINPORT</a>);
            }
            sp = <span class="keyword">new</span> <a class="code" href="classWindowsSimPort.html" title="Base class for virtual ports.">WindowsSimPort</a>(winport);
<span class="preprocessor">#endif //OBDPLATFORM_WINDOWS</span>
<span class="preprocessor"></span>            <span class="keywordflow">break</span>;
    }

    <span class="keywordflow">if</span>(NULL == sp || !sp-&gt;<a class="code" href="classOBDSimPort.html#afc80a2499b399ac4d5367ba01d101ee7" title="Find out if this initialised correctly.">isUsable</a>()) {
        fprintf(stderr,<span class="stringliteral">&quot;Error creating virtual port\n&quot;</span>);
        <span class="keywordflow">return</span> 1;
    }

    <span class="keywordflow">if</span>(NULL != logfile_name) {
        sp-&gt;<a class="code" href="classOBDSimPort.html#aee27f88c23aade186e7638368788326c" title="Enable or disable logging.">startLog</a>(logfile_name);
    }

    <span class="keywordtype">char</span> *slave_name = sp-&gt;<a class="code" href="classOBDSimPort.html#ad049c0c5e44682c5685ee33d53a343ae" title="Get a string representing the port as it&#39;s exposed.">getPort</a>();
    <span class="keywordflow">if</span>(NULL == slave_name) {
        printf(<span class="stringliteral">&quot;Couldn&#39;t get slave name for pty\n&quot;</span>);
        <span class="keyword">delete</span> sp;
        <span class="keywordflow">return</span> 1;
    }

    printf(<span class="stringliteral">&quot;SimPort name: %s\n&quot;</span>, slave_name);

<span class="preprocessor">#ifdef OBDPLATFORM_POSIX</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span>(launch_logger) {
        spawnlogger(slave_name);
    }
    <span class="keywordflow">if</span>(launch_terminal) {
        <span class="keywordflow">switch</span>(simport_requested) {
<span class="preprocessor">#ifdef HAVE_SOCKET</span>
<span class="preprocessor"></span>            <span class="keywordflow">case</span> <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea5871ad435798cb0526adb06a3c1bd6dd">SIMPORT_SOCKET</a>:
                spawntelnet(socket_port);
                <span class="keywordflow">break</span>;
<span class="preprocessor">#endif // HAVE_SOCKET</span>
<span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_BLUETOOTH</span>
<span class="preprocessor"></span>            <span class="keywordflow">case</span> <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea907b04e1c2997ecfa00cbf520aa1856c">SIMPORT_BLUETOOTH</a>:
                printf(<span class="stringliteral">&quot;Don&#39;t know how to connect a terminal to bluetooth\n&quot;</span>);
                <span class="keywordflow">break</span>;
<span class="preprocessor">#endif //HAVE_BLUETOOTH</span>
<span class="preprocessor"></span>            <span class="keywordflow">case</span> <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea31546da48f30fbf4034a8839ef9e8b1a">SIMPORT_DEFAULT</a>:
            <span class="keywordflow">case</span> <a class="code" href="obdsim_8cc.html#ab6b66e12ac855be3da8b94b1d8825c1ea8eda7f1b0e59cbb55957a5b68df39b63">SIMPORT_SERIAL</a>:
            <span class="keywordflow">default</span>:
                spawnscreen(slave_name);
                <span class="keywordflow">break</span>;
        }
    }
<span class="preprocessor">#endif //OBDPLATFORM_POSIX</span>
<span class="preprocessor"></span>
    printf(<span class="stringliteral">&quot;Successfully initialised obdsim, entering main loop\n&quot;</span>);
    <a class="code" href="mainloop_8cc.html#a7845bf3bf6f4c940c5f5e5bdaf7fa724" title="It&#39;s a main loop.">main_loop</a>(sp, &amp;ss);

    <span class="keywordflow">for</span>(i=0;i&lt;ss.ecu_count;i++) {
        ss.ecus[i].simgen-&gt;destroy(ss.ecus[i].dg);
    }

    <span class="keyword">delete</span> sp;

    <span class="keywordflow">if</span>(NULL != logfile_name) {
        free(logfile_name);
    }

    <span class="keywordflow">if</span>(NULL != seedstr) {
        free(seedstr);
    }

    <span class="keywordflow">if</span>(NULL != ss.elm_version) {
        free(ss.elm_version);
    }

    <span class="keywordflow">if</span>(NULL != ss.elm_device) {
        free(ss.elm_device);
    }

<span class="preprocessor">#ifdef OBDPLATFORM_WINDOWS</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span>(NULL != winport) {
        free(winport);
    }
<span class="preprocessor">#endif //OBDPLATFORM_WINDOWS</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifdef OBDPLATFORM_POSIX</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span>(NULL != tty_device) {
        free(tty_device);
    }
<span class="preprocessor">#endif //OBDPLATFORM_POSIX</span>
<span class="preprocessor"></span>
    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="obdsim_8cc_a3c04138a5bfe5d72780bb7e82a18e627_cgraph.png" border="0" usemap="#obdsim_8cc_a3c04138a5bfe5d72780bb7e82a18e627_cgraph" alt=""/></div>
<map name="obdsim_8cc_a3c04138a5bfe5d72780bb7e82a18e627_cgraph" id="obdsim_8cc_a3c04138a5bfe5d72780bb7e82a18e627_cgraph">
<area shape="rect" id="node3" href="obdsim_8cc.html#aece73156637283e1b9da36d6f38d7f3e" title="Create a sorted list for the ECUs to respond in, based on their delays." alt="" coords="127,109,236,139"/><area shape="rect" id="node5" href="obdsim_8cc.html#a8ec063a8765a65d2d426c7a921ec4709" title="Find the generator of the given name." alt="" coords="131,162,232,193"/><area shape="rect" id="node7" href="classOBDSimPort.html#ad049c0c5e44682c5685ee33d53a343ae" title="Get a string representing the port as it&#39;s exposed." alt="" coords="109,215,253,246"/><area shape="rect" id="node9" href="classOBDSimPort.html#afc80a2499b399ac4d5367ba01d101ee7" title="Find out if this initialised correctly." alt="" coords="104,269,259,299"/><area shape="rect" id="node11" href="mainloop_8cc.html#a7845bf3bf6f4c940c5f5e5bdaf7fa724" title="It&#39;s a main loop." alt="" coords="141,322,221,353"/><area shape="rect" id="node23" href="obdsim_8cc.html#ad44d5c5f3cd4edd3fa2428b2b1989817" title="Given a protocol [A]{0&#45;9}, set the protocol in the struct." alt="" coords="560,455,675,486"/><area shape="rect" id="node36" href="obdsim_8cc.html#a1841e9bf638907641fb2745f4d63aa4d" title="Initialse all variables in a simsettings." alt="" coords="308,429,492,459"/><area shape="rect" id="node42" href="obdsim_8cc.html#a70e2dd9d98c065680177b32e6c31e460" title="Print the genrators this was linked with." alt="" coords="131,503,232,534"/><area shape="rect" id="node44" href="boxwhisker_8c.html#aad6f83147b5881b56d147e6ee8803e47" title="Print help." alt="" coords="147,557,216,587"/><area shape="rect" id="node46" href="obdsim_8cc.html#a736325befc39d947b3600a83ba4512c8" title="Print all protocol info to stdout." alt="" coords="121,610,241,641"/><area shape="rect" id="node48" href="ftdipty_8c.html#a246ce0006add3670842eac6712fb40b1" title="Print the version string." alt="" coords="137,663,225,694"/><area shape="rect" id="node51" href="obdsim_8cc.html#a91cb6a1e4a66445106f1c62b1bec114b" title="Print the long description provided by the generator." alt="" coords="129,717,233,747"/><area shape="rect" id="node53" href="classOBDSimPort.html#aee27f88c23aade186e7638368788326c" title="Enable or disable logging." alt="" coords="107,770,256,801"/><area shape="rect" id="node13" href="windowssimport_8cc.html#aaf2d0a99430a6d5253b8c395c30ca7e3" title="gettimeofday" alt="" coords="352,322,448,353"/><area shape="rect" id="node15" href="obdservicecommands_8c.html#a05b8663c29e16cee47f4f3e26440a6bf" title="Return the obdservicecmd struct for the requested db_column name." alt="" coords="335,375,465,406"/><area shape="rect" id="node17" href="mainloop_8cc.html#af9c6b78a9ef66e89d0f86727e7c272fd" title="Update the freeze frame info for all the ecus." alt="" coords="327,5,473,35"/><area shape="rect" id="node19" href="mainloop_8cc.html#ab174b6c03d9ca358eaac19179b8bc6f9" title="Parse this AT command [assumes that line is already known to be an AT command]." alt="" coords="349,109,451,139"/><area shape="rect" id="node27" href="classOBDSimPort.html#a22999b9d50ba1ba4bddf54a52b6d361f" title="Enable or disable echo." alt="" coords="541,83,693,114"/><area shape="rect" id="node29" href="classOBDSimPort.html#a4ec16a68bf5f497fc6f950d97f560891" title="Read a line from the virtual port." alt="" coords="324,162,476,193"/><area shape="rect" id="node31" href="mainloop_8cc.html#af089431878966f803a505fbea053015c" title="Render a header into the passed string." alt="" coords="337,215,463,246"/><area shape="rect" id="node34" href="classOBDSimPort.html#a0a5358d2174f453ea2ceceeea9641b6e" title="Write some data to the port." alt="" coords="321,269,479,299"/><area shape="rect" id="node21" href="obdsim_8cc.html#a312e77640a7dced86271f8afd3919342" title="Do an elm reset [ATZ or similar]." alt="" coords="557,243,677,274"/><area shape="rect" id="node25" href="obdsim_8cc.html#ae06d636c0fff4bc4d72b642fb832011a" title="Given the single char, find the protocol for it." alt="" coords="743,455,857,486"/><area shape="rect" id="node39" href="obdsim_8cc.html#a1fe4a2896c7cb031178c170c3645ecb8" title="Default sim generator for windows users is the gui." alt="" coords="548,402,687,433"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a312e77640a7dced86271f8afd3919342"></a><!-- doxytag: member="obdsim.cc::obdsim_elmreset" ref="a312e77640a7dced86271f8afd3919342" args="(struct simsettings *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void obdsim_elmreset </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsimsettings.html">simsettings</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Do an elm reset [ATZ or similar]. </p>
<p>To a reset on the elm device [ATZ/D/WS]. </p>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00165">165</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                            {
    s-&gt;<a class="code" href="structsimsettings.html#a375a400eb29f8711b1aa57bccbd089aa">e_headers</a> = <a class="code" href="obdsim_8h.html#aeac1c1abe73ea9f7bbd78e6a90b09ac9" title="Default hide headers.">ELM_HEADERS</a>;
    s-&gt;<a class="code" href="structsimsettings.html#ab0165fc2a53904154ea61306a74e35c8">e_spaces</a> = <a class="code" href="obdsim_8h.html#a99b92c8bda214df9fda28ab1fc9e3e91" title="Default show spaces.">ELM_SPACES</a>;
    s-&gt;<a class="code" href="structsimsettings.html#ad891edc20d73ad6e2891cc2a5ec08f90">e_echo</a> = <a class="code" href="obdsim_8h.html#ab75da6196db1074e34b942d6b3c4c8fb" title="Default echo.">ELM_ECHO</a>;
    s-&gt;<a class="code" href="structsimsettings.html#a87028403088260afbc398b332fa5b3b8">e_linefeed</a> = <a class="code" href="obdsim_8h.html#ac809efce5f4296a3ca1999016f6bd4f1" title="Default linefeed.">ELM_LINEFEED</a>;
    s-&gt;<a class="code" href="structsimsettings.html#af422937b58a2d53f2846d26409757995">e_timeout</a> = <a class="code" href="obdsim_8h.html#af2eac2878dc0de04d1f58b5f45973835" title="Default timeout, milliseconds.">ELM_TIMEOUT</a>;
    s-&gt;<a class="code" href="structsimsettings.html#a8c49e774337d795a1b7c7b1a4b34fc93">e_adaptive</a> = <a class="code" href="obdsim_8h.html#a0d503412c591e5e9276ecbd1660f0572" title="Adaptive timing [0,1,2].">ELM_ADAPTIVETIMING</a>;
    s-&gt;<a class="code" href="structsimsettings.html#a72abab27893a60ba0de120c770706037">e_dlc</a> = <a class="code" href="obdsim_8h.html#a38b105675a99c2309fa3480199db16fb" title="DLC Dispaly.">ELM_DISPLAYDLC</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1fe4a2896c7cb031178c170c3645ecb8"></a><!-- doxytag: member="obdsim.cc::obdsim_initialiseecu" ref="a1fe4a2896c7cb031178c170c3645ecb8" args="(struct obdgen_ecu *e)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void obdsim_initialiseecu </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobdgen__ecu.html">obdgen_ecu</a> *&#160;</td>
          <td class="paramname"><em>e</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Default sim generator for windows users is the gui. </p>
<p>Initialise the variables in an ECU </p>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00130">130</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                                {
    e-&gt;<a class="code" href="structobdgen__ecu.html#a16ed25e69b333ae373fa93baa6e90869">simgen</a> = NULL;
    e-&gt;<a class="code" href="structobdgen__ecu.html#aa24fa38c8ea9e904b477022a3faca3d7">ecu_num</a> = 0;
    e-&gt;<a class="code" href="structobdgen__ecu.html#a617dfdd19c038a284d50b808e1d43b6f">seed</a> = NULL;
    e-&gt;<a class="code" href="structobdgen__ecu.html#a30ee9324e653ba30dff64e0227dd13fb">lasterrorcount</a> = 0;
    e-&gt;<a class="code" href="structobdgen__ecu.html#ac37412ba6e36cf579348025a6b26e4fc">ffcount</a> = 0;
    e-&gt;<a class="code" href="structobdgen__ecu.html#a83ca935e0a8bb26117648503be6a3537">dg</a> = 0;
    e-&gt;<a class="code" href="structobdgen__ecu.html#a01de03442118006704e9b57b0dbeefe2">customdelay</a> = 0;
    memset(e-&gt;<a class="code" href="structobdgen__ecu.html#a0af05780f686ceb86b3269fff68ef9aa">ff</a>, 0, <span class="keyword">sizeof</span>(e-&gt;<a class="code" href="structobdgen__ecu.html#a0af05780f686ceb86b3269fff68ef9aa">ff</a>));
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1841e9bf638907641fb2745f4d63aa4d"></a><!-- doxytag: member="obdsim.cc::obdsim_initialisesimsettings" ref="a1841e9bf638907641fb2745f4d63aa4d" args="(struct simsettings *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void obdsim_initialisesimsettings </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsimsettings.html">simsettings</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialse all variables in a simsettings. </p>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00142">142</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                                         {
    s-&gt;<a class="code" href="structsimsettings.html#a03122be32c375fa7e298990a27da3255">e_autoprotocol</a> = 1;
    <a class="code" href="obdsim_8cc.html#ad44d5c5f3cd4edd3fa2428b2b1989817" title="Given a protocol [A]{0-9}, set the protocol in the struct.">set_obdprotocol</a>(<a class="code" href="obdsim_8h.html#ae975e6f8036c6830fc90d16868f7f9e6" title="Default protocol. Looked up early on - better match something from the above list.">OBDSIM_DEFAULT_PROTOCOLNUM</a>, s);

    s-&gt;<a class="code" href="structsimsettings.html#a104f7e14f94e881ac267fb1fe18d4a3a">benchmark</a> = <a class="code" href="obdsim_8h.html#a55cd3da5fb83616e7e2c7f02f406d1ff" title="Print out benchmarks every this often [seconds].">OBDSIM_BENCHMARKTIME</a>;
    s-&gt;<a class="code" href="structsimsettings.html#a40db10aa85a57f2fe32f03a2f1a981cd">e_currentvoltage</a> = <a class="code" href="obdsim_8h.html#a893a7a1c58e5990ee9904d3678655a89" title="Default car battery voltage.">OBDSIM_BATTERYV</a>;

    s-&gt;<a class="code" href="structsimsettings.html#ad31664e10f5d192f916b5c56fee4e8c6">device_identifier</a> = strdup(<span class="stringliteral">&quot;ChunkyKs&quot;</span>);
    s-&gt;<a class="code" href="structsimsettings.html#a11b55830ffd03a241eed19dd6108e6fd">elm_device</a> = strdup(OBDSIM_ELM_DEVICE_STRING);
    s-&gt;<a class="code" href="structsimsettings.html#a9fb20d6a413e2520f00796cc65c7f38b">elm_version</a> = strdup(OBDSIM_ELM_VERSION_STRING);

    s-&gt;<a class="code" href="structsimsettings.html#acdb4747bd4a5667e6093600988ff33c2">ecu_count</a> = 0;
    <span class="keywordtype">int</span> i;
    <span class="keywordflow">for</span>(i = 0; i&lt;<a class="code" href="obdsim_8h.html#a5b0dbd8e6a7ad6c03b3394ce73887a57" title="Hardcode maximum number of ECUs/generators.">OBDSIM_MAXECUS</a>; i++) {
        <a class="code" href="obdsim_8cc.html#a1fe4a2896c7cb031178c170c3645ecb8" title="Default sim generator for windows users is the gui.">obdsim_initialiseecu</a>(&amp;s-&gt;<a class="code" href="structsimsettings.html#a59c88da427815ecd7d98ff4c5439f02a">ecus</a>[i]);
        s-&gt;<a class="code" href="structsimsettings.html#aa4983134adb95a1ea96e74b570184c2b">ecudelays</a>[i].<a class="code" href="structobdgen__ecudelays.html#aed28500a4775cbbf813b0a9de84eb841">ecu</a> = NULL;
        s-&gt;<a class="code" href="structsimsettings.html#aa4983134adb95a1ea96e74b570184c2b">ecudelays</a>[i].<a class="code" href="structobdgen__ecudelays.html#a547ac7ebb179a80a00dc4d251d163da6">delay</a> = 0;
    }

    <a class="code" href="obdsim_8cc.html#a312e77640a7dced86271f8afd3919342" title="Do an elm reset [ATZ or similar].">obdsim_elmreset</a>(s);
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="obdsim_8cc_a1841e9bf638907641fb2745f4d63aa4d_cgraph.png" border="0" usemap="#obdsim_8cc_a1841e9bf638907641fb2745f4d63aa4d_cgraph" alt=""/></div>
<map name="obdsim_8cc_a1841e9bf638907641fb2745f4d63aa4d_cgraph" id="obdsim_8cc_a1841e9bf638907641fb2745f4d63aa4d_cgraph">
<area shape="rect" id="node3" href="obdsim_8cc.html#a312e77640a7dced86271f8afd3919342" title="Do an elm reset [ATZ or similar]." alt="" coords="249,5,369,35"/><area shape="rect" id="node5" href="obdsim_8cc.html#a1fe4a2896c7cb031178c170c3645ecb8" title="Default sim generator for windows users is the gui." alt="" coords="240,58,379,89"/><area shape="rect" id="node7" href="obdsim_8cc.html#ad44d5c5f3cd4edd3fa2428b2b1989817" title="Given a protocol [A]{0&#45;9}, set the protocol in the struct." alt="" coords="252,111,367,142"/><area shape="rect" id="node9" href="obdsim_8cc.html#ae06d636c0fff4bc4d72b642fb832011a" title="Given the single char, find the protocol for it." alt="" coords="428,111,543,142"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a70e2dd9d98c065680177b32e6c31e460"></a><!-- doxytag: member="obdsim.cc::printgenerator" ref="a70e2dd9d98c065680177b32e6c31e460" args="(int verbose)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void printgenerator </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verbose</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Print the genrators this was linked with. </p>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00766">766</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                 {
    <span class="keywordflow">if</span>(verbose) {
        printf(<span class="stringliteral">&quot;The generators built into this sim:\n&quot;</span>);
    }

    <span class="comment">// If we find the one currently #defined as default</span>
    <span class="keywordtype">int</span> found_default = 0;

    <span class="keywordtype">size_t</span> i;
    <span class="keywordflow">for</span>(i=0; i&lt;<span class="keyword">sizeof</span>(<a class="code" href="obdsim_8cc.html#ab952efb1bb7b17e33003cd38731b69ea" title="A list of all available generators in this build.">available_generators</a>)/<span class="keyword">sizeof</span>(<a class="code" href="obdsim_8cc.html#ab952efb1bb7b17e33003cd38731b69ea" title="A list of all available generators in this build.">available_generators</a>[0]); i++) {
        <span class="keywordtype">int</span> is_default = !strcmp(<a class="code" href="obdsim_8h.html#aabfadf7f11899ab21341f981b267cfc9" title="Default sim generator.">DEFAULT_SIMGEN</a>, <a class="code" href="obdsim_8cc.html#ab952efb1bb7b17e33003cd38731b69ea" title="A list of all available generators in this build.">available_generators</a>[i]-&gt;<a class="code" href="structobdsim__generator.html#a5894348c1fe0ad2c4724c62bea6b8b5b" title="Get a human-friendly name for this generator.">name</a>());
        <span class="keywordflow">if</span>(is_default) found_default = 1;
        <span class="keywordflow">if</span>(verbose) {
            printf(<span class="stringliteral">&quot; \&quot;%s\&quot;%s\n&quot;</span>, 
                <a class="code" href="obdsim_8cc.html#ab952efb1bb7b17e33003cd38731b69ea" title="A list of all available generators in this build.">available_generators</a>[i]-&gt;<a class="code" href="structobdsim__generator.html#a5894348c1fe0ad2c4724c62bea6b8b5b" title="Get a human-friendly name for this generator.">name</a>(),
                is_default?<span class="stringliteral">&quot; (default)&quot;</span>:<span class="stringliteral">&quot;&quot;</span>);
        } <span class="keywordflow">else</span> {
            printf(<span class="stringliteral">&quot;%s%s\n&quot;</span>, 
                is_default?<span class="stringliteral">&quot;* &quot;</span>:<span class="stringliteral">&quot;  &quot;</span>,
                <a class="code" href="obdsim_8cc.html#ab952efb1bb7b17e33003cd38731b69ea" title="A list of all available generators in this build.">available_generators</a>[i]-&gt;<a class="code" href="structobdsim__generator.html#a5894348c1fe0ad2c4724c62bea6b8b5b" title="Get a human-friendly name for this generator.">name</a>());
        }
    }


    <span class="keywordflow">if</span>(0 == found_default &amp;&amp; verbose) {
        printf(<span class="stringliteral">&quot;No default generator\n&quot;</span>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aad6f83147b5881b56d147e6ee8803e47"></a><!-- doxytag: member="obdsim.cc::printhelp" ref="aad6f83147b5881b56d147e6ee8803e47" args="(const char *argv0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void printhelp </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>argv0</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Print Help for --help. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">argv0</td><td>your program's argv[0] </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00724">724</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                  {
    printf(<span class="stringliteral">&quot;Usage: %s [params]\n&quot;</span>
        <span class="stringliteral">&quot;   [-g|--generator=&lt;name of generator&gt;\n&quot;</span>
        <span class="stringliteral">&quot;       [-s|--seed=&lt;generator-seed&gt;]\n&quot;</span>
        <span class="stringliteral">&quot;       [-d|--customdelay=&lt;ecu delay(ms)&gt;]\n&quot;</span>
        <span class="stringliteral">&quot;     ]\n&quot;</span>
        <span class="stringliteral">&quot;   [-q|--logfile=&lt;logfilename to write to&gt;]\n&quot;</span>
        <span class="stringliteral">&quot;   [-V|--elm-version=&lt;pretend to be this on ATZ&gt;]\n&quot;</span>
        <span class="stringliteral">&quot;   [-D|--elm-device=&lt;pretend to be this on AT@1&gt;]\n&quot;</span>
        <span class="stringliteral">&quot;   [-L|--list-protocols]\n&quot;</span>
        <span class="stringliteral">&quot;   [-p|--protocol=&lt;OBDII protocol&gt;]\n&quot;</span>
#ifdef OBDPLATFORM_POSIX
        <span class="stringliteral">&quot;   [-o|--launch-logger]\n&quot;</span>
        <span class="stringliteral">&quot;   [-c|--launch-screen] [\&quot;EXIT\&quot; or C-a,k to exit]\n&quot;</span>
        <span class="stringliteral">&quot;   [-t|--tty-device=&lt;real /dev/ entry to open&gt;]\n&quot;</span>
#endif <span class="comment">//OBDPLATFORM_POSIX</span>
#ifdef OBDPLATFORM_WINDOWS
        <span class="stringliteral">&quot;   [-w|--com-port=&lt;windows COM port&gt;]\n&quot;</span>
#endif <span class="comment">//OBDPLATFORM_WINDOWS</span>
#ifdef HAVE_BLUETOOTH
        <span class="stringliteral">&quot;   [-b|--bluetooth]\n&quot;</span>
#endif <span class="comment">//HAVE_BLUETOOTH</span>
#ifdef HAVE_SOCKET
        <span class="stringliteral">&quot;   [-k|--socket=&lt;listen port&gt;]\n&quot;</span>
#endif <span class="comment">//HAVE_SOCKET</span>
        <span class="stringliteral">&quot;   [-e|--genhelp=&lt;name of generator&gt;]\n&quot;</span>
        <span class="stringliteral">&quot;   [-l|--list-generators]\n&quot;</span>
        <span class="stringliteral">&quot;   [-n|--benchmark=&lt;seconds&gt;]\n&quot;</span>
        <span class="stringliteral">&quot;   [-v|--version] [-h|--help]\n&quot;</span>, argv0);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a736325befc39d947b3600a83ba4512c8"></a><!-- doxytag: member="obdsim.cc::printobdprotocols" ref="a736325befc39d947b3600a83ba4512c8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void printobdprotocols </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Print all protocol info to stdout. </p>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00759">759</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                         {
    <span class="keywordtype">int</span> i;
    <span class="keywordflow">for</span>(i=0; i&lt;<span class="keyword">sizeof</span>(<a class="code" href="obdsim_8h.html#ae7bdb4a8033475d61f57ff336481cd56" title="All the protocols I know or care about.">obdprotocols</a>)/<span class="keyword">sizeof</span>(<a class="code" href="obdsim_8h.html#ae7bdb4a8033475d61f57ff336481cd56" title="All the protocols I know or care about.">obdprotocols</a>[0]); i++) {
        printf(<span class="stringliteral">&quot;%c  %s\n&quot;</span>, <a class="code" href="obdsim_8h.html#ae7bdb4a8033475d61f57ff336481cd56" title="All the protocols I know or care about.">obdprotocols</a>[i].protocol_num,  <a class="code" href="obdsim_8h.html#ae7bdb4a8033475d61f57ff336481cd56" title="All the protocols I know or care about.">obdprotocols</a>[i].protocol_desc);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a246ce0006add3670842eac6712fb40b1"></a><!-- doxytag: member="obdsim.cc::printversion" ref="a246ce0006add3670842eac6712fb40b1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void printversion </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Print the version string. </p>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00755">755</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                    {
    printf(<span class="stringliteral">&quot;Version: %i.%i\n&quot;</span>, OBDGPSLOGGER_MAJOR_VERSION, OBDGPSLOGGER_MINOR_VERSION);
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad44d5c5f3cd4edd3fa2428b2b1989817"></a><!-- doxytag: member="obdsim.cc::set_obdprotocol" ref="ad44d5c5f3cd4edd3fa2428b2b1989817" args="(const char *prot, struct simsettings *ss)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int set_obdprotocol </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>prot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsimsettings.html">simsettings</a> *&#160;</td>
          <td class="paramname"><em>ss</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Given a protocol [A]{0-9}, set the protocol in the struct. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 for success, &lt;0 for failure </dd></dl>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00677">677</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                                              {
    <span class="keywordflow">if</span>(NULL == prot) {
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">// Allow spaces in various places even though behaviour isn&#39;t very well defined</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span> *p = prot;
    <span class="keywordflow">while</span>(<span class="charliteral">&#39; &#39;</span> == *p &amp;&amp; <span class="charliteral">&#39;\0&#39;</span> != *p) p++;
    <span class="keywordflow">if</span>(<span class="charliteral">&#39;\0&#39;</span> == *p) {
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordtype">int</span> e_autoprotocol = 0;
    <span class="keywordflow">if</span>(<span class="charliteral">&#39;A&#39;</span> == *p || <span class="charliteral">&#39;a&#39;</span> == *p) {
        e_autoprotocol = 1;
        p++;
    }
    <span class="keywordflow">while</span>(<span class="charliteral">&#39; &#39;</span> == *p &amp;&amp; <span class="charliteral">&#39;\0&#39;</span> != *p) p++;

    <span class="keyword">struct </span><a class="code" href="structobdiiprotocol.html" title="Each OBDII Protocol has a number and description.">obdiiprotocol</a> *e_protocol = <a class="code" href="obdsim_8cc.html#ae06d636c0fff4bc4d72b642fb832011a" title="Given the single char, find the protocol for it.">find_obdprotocol</a>(p);
    p++;
    <span class="keywordflow">if</span>(NULL == e_protocol) {
        <span class="keywordflow">return</span> -1;
    }
    <span class="keywordflow">while</span>(<span class="charliteral">&#39; &#39;</span> == *p &amp;&amp; <span class="charliteral">&#39;\0&#39;</span> != *p) p++;

    <span class="keywordflow">if</span>(<span class="charliteral">&#39;A&#39;</span> == *p || <span class="charliteral">&#39;a&#39;</span> == *p) {
        e_autoprotocol = 1;
    }

    ss-&gt;<a class="code" href="structsimsettings.html#a2d35245cb79492e7e9661c2cd98d908d">e_protocol</a> = e_protocol;
    ss-&gt;<a class="code" href="structsimsettings.html#a03122be32c375fa7e298990a27da3255">e_autoprotocol</a> = e_autoprotocol;

    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="obdsim_8cc_ad44d5c5f3cd4edd3fa2428b2b1989817_cgraph.png" border="0" usemap="#obdsim_8cc_ad44d5c5f3cd4edd3fa2428b2b1989817_cgraph" alt=""/></div>
<map name="obdsim_8cc_ad44d5c5f3cd4edd3fa2428b2b1989817_cgraph" id="obdsim_8cc_ad44d5c5f3cd4edd3fa2428b2b1989817_cgraph">
<area shape="rect" id="node3" href="obdsim_8cc.html#ae06d636c0fff4bc4d72b642fb832011a" title="Given the single char, find the protocol for it." alt="" coords="169,5,284,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a91cb6a1e4a66445106f1c62b1bec114b"></a><!-- doxytag: member="obdsim.cc::show_genhelp" ref="a91cb6a1e4a66445106f1c62b1bec114b" args="(struct obdsim_generator *gen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void show_genhelp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structobdsim__generator.html">obdsim_generator</a> *&#160;</td>
          <td class="paramname"><em>gen</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Print the long description provided by the generator. </p>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00653">653</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>
<div class="fragment"><pre class="fragment">                                                {
    <span class="keywordflow">if</span>(NULL == gen) {
        fprintf(stderr, <span class="stringliteral">&quot;Cannot print help for nonexistent generator\n&quot;</span>);
        <span class="keywordflow">return</span>;
    }

    printf(<span class="stringliteral">&quot;Long help for generator \&quot;%s\&quot;:\n\n%s\n\n&quot;</span>, gen-&gt;<a class="code" href="structobdsim__generator.html#a5894348c1fe0ad2c4724c62bea6b8b5b" title="Get a human-friendly name for this generator.">name</a>(),
        NULL==gen-&gt;<a class="code" href="structobdsim__generator.html#a11cb7f396e1ead5fb41e73e2e89ed2d7" title="Get a long description [typically including seed info] for this generator.">longdesc</a>?
            <span class="stringliteral">&quot;Generator doesn&#39;t offer long description&quot;</span>:
            gen-&gt;<a class="code" href="structobdsim__generator.html#a11cb7f396e1ead5fb41e73e2e89ed2d7" title="Get a long description [typically including seed info] for this generator.">longdesc</a>());
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ab952efb1bb7b17e33003cd38731b69ea"></a><!-- doxytag: member="obdsim.cc::available_generators" ref="ab952efb1bb7b17e33003cd38731b69ea" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structobdsim__generator.html">obdsim_generator</a>* <a class="el" href="obdsim_8cc.html#ab952efb1bb7b17e33003cd38731b69ea">available_generators</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {


 


 


 


 


 


 


 


 


 
}
</pre></div>
<p>A list of all available generators in this build. </p>

<p>Definition at line <a class="el" href="obdsim_8cc_source.html#l00092">92</a> of file <a class="el" href="obdsim_8cc_source.html">obdsim.cc</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Apr 8 2012 21:46:30 for Logger by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
