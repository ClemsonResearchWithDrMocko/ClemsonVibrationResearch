<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Logger: repair/obdrepair.h File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Logger
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9ed0befebb29faa6582a147d8fa7d33a.html">repair</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">obdrepair.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;sqlite3.h&quot;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for obdrepair.h:</div>
<div class="dyncontent">
<div class="center"><img src="obdrepair_8h__incl.png" border="0" usemap="#repair_2obdrepair_8h" alt=""/></div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="obdrepair_8h__dep__incl.png" border="0" usemap="#repair_2obdrepair_8hdep" alt=""/></div>
<map name="repair_2obdrepair_8hdep" id="repair_2obdrepair_8hdep">
<area shape="rect" id="node3" href="obdrepair_8c.html" title="repair/obdrepair.c" alt="" coords="5,86,131,117"/><area shape="rect" id="node5" href="obdrepairmain_8c.html" title="repair/obdrepairmain.c" alt="" coords="155,86,309,117"/></map>
</div>
</div>
<p><a href="obdrepair_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdrepair_8h.html#ae706bce9fb0b4b96a33fb2c7dd5a8a42">checkindices</a> (sqlite3 *db)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Check indices on tables.  <a href="#ae706bce9fb0b4b96a33fb2c7dd5a8a42"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdrepair_8h.html#abd6bc8653fb10fa86431cb106c745aa2">checkobdecu</a> (sqlite3 *db)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Check ECU column on obd table.  <a href="#abd6bc8653fb10fa86431cb106c745aa2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdrepair_8h.html#afcfc30aae712bc373d4b9ce3e20bf153">checktripends</a> (sqlite3 *db)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Fix ends of trips.  <a href="#afcfc30aae712bc373d4b9ce3e20bf153"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdrepair_8h.html#ac54a1805666dc758af03ad791ba9c7fc">checktripids</a> (sqlite3 *db, const char *table_name)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Fix trip ids.  <a href="#ac54a1805666dc758af03ad791ba9c7fc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdrepair_8h.html#a2ad7b4ff199469297d7a846c3f2fedf7">analyze</a> (sqlite3 *db)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Run ANALYZE against the db.  <a href="#a2ad7b4ff199469297d7a846c3f2fedf7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="obdrepair_8h.html#ac1c539152ccf10e92042b56db4de09ec">checkintegrity</a> (sqlite3 *db)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Check the integrity of the database.  <a href="#ac1c539152ccf10e92042b56db4de09ec"></a><br/></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a2ad7b4ff199469297d7a846c3f2fedf7"></a><!-- doxytag: member="obdrepair.h::analyze" ref="a2ad7b4ff199469297d7a846c3f2fedf7" args="(sqlite3 *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="obdrepair_8h.html#a2ad7b4ff199469297d7a846c3f2fedf7">analyze</a> </td>
          <td>(</td>
          <td class="paramtype">sqlite3 *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Run ANALYZE against the db. </p>

<p>Definition at line <a class="el" href="obdrepair_8c_source.html#l00032">32</a> of file <a class="el" href="obdrepair_8c_source.html">obdrepair.c</a>.</p>
<div class="fragment"><pre class="fragment">                         {
    
    <span class="keywordtype">char</span> *errmsg;

    <span class="keywordflow">if</span>(SQLITE_OK != sqlite3_exec(db, <span class="stringliteral">&quot;ANALYZE&quot;</span>, NULL, NULL, &amp;errmsg)) {
        fprintf(stderr, <span class="stringliteral">&quot;ANALYZE error. SQL reported: %s\n&quot;</span>, errmsg);
        sqlite3_free(errmsg);
        <span class="keywordflow">return</span> -1;
    } <span class="keywordflow">else</span> {
        printf(<span class="stringliteral">&quot;Ran ANALYZE\n&quot;</span>);
        <span class="keywordflow">return</span> 0;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae706bce9fb0b4b96a33fb2c7dd5a8a42"></a><!-- doxytag: member="obdrepair.h::checkindices" ref="ae706bce9fb0b4b96a33fb2c7dd5a8a42" args="(sqlite3 *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="obdrepair_8h.html#ae706bce9fb0b4b96a33fb2c7dd5a8a42">checkindices</a> </td>
          <td>(</td>
          <td class="paramtype">sqlite3 *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check indices on tables. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if we changed nothing. -1 for error. &gt;0 if we changed stuff. </dd></dl>

<p>Definition at line <a class="el" href="obdrepair_8c_source.html#l00113">113</a> of file <a class="el" href="obdrepair_8c_source.html">obdrepair.c</a>.</p>
<div class="fragment"><pre class="fragment">                              {
    <span class="keywordtype">int</span> retvalue = 0;

    <span class="keywordtype">int</span> rc;
    rc = <a class="code" href="obdrepair_8c.html#afbcc7418437168d37a061063fe4053b0" title="Internal function for checkindices.">checkindex</a>(db, <span class="stringliteral">&quot;IDX_GPSTIME&quot;</span>, <span class="stringliteral">&quot;gps&quot;</span>, <span class="stringliteral">&quot;time&quot;</span>, 0);
    <span class="keywordflow">if</span>(-1 == rc) <span class="keywordflow">return</span> -1;
    <span class="keywordflow">if</span>(rc &gt; 0) retvalue++;

    <a class="code" href="obdrepair_8c.html#afbcc7418437168d37a061063fe4053b0" title="Internal function for checkindices.">checkindex</a>(db, <span class="stringliteral">&quot;IDX_GPSTRIP&quot;</span>, <span class="stringliteral">&quot;gps&quot;</span>, <span class="stringliteral">&quot;trip&quot;</span>, 0);
    <span class="keywordflow">if</span>(-1 == rc) <span class="keywordflow">return</span> -1;
    <span class="keywordflow">if</span>(rc &gt; 0) retvalue++;

    <a class="code" href="obdrepair_8c.html#afbcc7418437168d37a061063fe4053b0" title="Internal function for checkindices.">checkindex</a>(db, <span class="stringliteral">&quot;IDX_OBDTIME&quot;</span>, <span class="stringliteral">&quot;obd&quot;</span>, <span class="stringliteral">&quot;time&quot;</span>, 0);
    <span class="keywordflow">if</span>(-1 == rc) <span class="keywordflow">return</span> -1;
    <span class="keywordflow">if</span>(rc &gt; 0) retvalue++;

    <a class="code" href="obdrepair_8c.html#afbcc7418437168d37a061063fe4053b0" title="Internal function for checkindices.">checkindex</a>(db, <span class="stringliteral">&quot;IDX_OBDTRIP&quot;</span>, <span class="stringliteral">&quot;obd&quot;</span>, <span class="stringliteral">&quot;trip&quot;</span>, 0);
    <span class="keywordflow">if</span>(-1 == rc) <span class="keywordflow">return</span> -1;
    <span class="keywordflow">if</span>(rc &gt; 0) retvalue++;

    <a class="code" href="obdrepair_8c.html#afbcc7418437168d37a061063fe4053b0" title="Internal function for checkindices.">checkindex</a>(db, <span class="stringliteral">&quot;IDX_VINECU&quot;</span>, <span class="stringliteral">&quot;ecu&quot;</span>, <span class="stringliteral">&quot;vin,ecu&quot;</span>, 1);
    <span class="keywordflow">if</span>(-1 == rc) <span class="keywordflow">return</span> -1;
    <span class="keywordflow">if</span>(rc &gt; 0) retvalue++;

    <span class="keywordflow">return</span> retvalue;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="obdrepair_8h_ae706bce9fb0b4b96a33fb2c7dd5a8a42_cgraph.png" border="0" usemap="#obdrepair_8h_ae706bce9fb0b4b96a33fb2c7dd5a8a42_cgraph" alt=""/></div>
<map name="obdrepair_8h_ae706bce9fb0b4b96a33fb2c7dd5a8a42_cgraph" id="obdrepair_8h_ae706bce9fb0b4b96a33fb2c7dd5a8a42_cgraph">
<area shape="rect" id="node3" href="obdrepair_8c.html#afbcc7418437168d37a061063fe4053b0" title="Internal function for checkindices." alt="" coords="155,5,245,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac1c539152ccf10e92042b56db4de09ec"></a><!-- doxytag: member="obdrepair.h::checkintegrity" ref="ac1c539152ccf10e92042b56db4de09ec" args="(sqlite3 *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="obdrepair_8h.html#ac1c539152ccf10e92042b56db4de09ec">checkintegrity</a> </td>
          <td>(</td>
          <td class="paramtype">sqlite3 *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check the integrity of the database. </p>

<p>Definition at line <a class="el" href="obdrepair_8c_source.html#l00046">46</a> of file <a class="el" href="obdrepair_8c_source.html">obdrepair.c</a>.</p>
<div class="fragment"><pre class="fragment">                                {
    sqlite3_stmt *stmt;
    <span class="keywordtype">int</span> rc;
    <span class="keywordtype">char</span> pragma_sql[] = <span class="stringliteral">&quot;PRAGMA integrity_check(1000)&quot;</span>;

    <span class="keywordflow">if</span>(SQLITE_OK != (rc = sqlite3_prepare_v2(db, pragma_sql, -1, &amp;stmt, NULL))) {
        fprintf(stderr,<span class="stringliteral">&quot;Error preparing SQL: (%i) %s\nSQL: \&quot;%s\&quot;\n&quot;</span>, rc, sqlite3_errmsg(db), pragma_sql);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordtype">int</span> found_error = 0;
    <span class="keywordflow">while</span>(SQLITE_ROW == sqlite3_step(stmt)) {
        <span class="keyword">const</span> <span class="keywordtype">char</span> *integ = sqlite3_column_text(stmt, 0);
        <span class="keywordflow">if</span>(0 != strcmp(integ, <span class="stringliteral">&quot;ok&quot;</span>)) found_error++;
        printf(<span class="stringliteral">&quot;Integrity response: %s\n&quot;</span>, integ);
    }

    <span class="keywordflow">if</span>(found_error &gt; 0) {
        printf(<span class="stringliteral">&quot;Found error in integrity check. Cannot safely continue\n&quot;</span>);
    }

    sqlite3_finalize(stmt);

    <span class="keywordflow">return</span> found_error;
}
</pre></div>
</div>
</div>
<a class="anchor" id="abd6bc8653fb10fa86431cb106c745aa2"></a><!-- doxytag: member="obdrepair.h::checkobdecu" ref="abd6bc8653fb10fa86431cb106c745aa2" args="(sqlite3 *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="obdrepair_8h.html#abd6bc8653fb10fa86431cb106c745aa2">checkobdecu</a> </td>
          <td>(</td>
          <td class="paramtype">sqlite3 *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check ECU column on obd table. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if we changed nothing. -1 for error. &gt;0 if we changed stuff. </dd></dl>

<p>Definition at line <a class="el" href="obdrepair_8c_source.html#l00072">72</a> of file <a class="el" href="obdrepair_8c_source.html">obdrepair.c</a>.</p>
<div class="fragment"><pre class="fragment">                             {
    <span class="keywordtype">int</span> retvalue = 0;
    <span class="keywordtype">int</span> rc = 0;
    <span class="keywordtype">char</span> *errmsg = NULL;

    sqlite3_stmt *stmt;

    <span class="keywordtype">char</span> pragma_sql[256];
    snprintf(pragma_sql, <span class="keyword">sizeof</span>(pragma_sql), <span class="stringliteral">&quot;PRAGMA table_info(obd)&quot;</span>);

    <span class="keywordflow">if</span>(SQLITE_OK != (rc = sqlite3_prepare_v2(db, pragma_sql, -1, &amp;stmt, NULL))) {
        fprintf(stderr,<span class="stringliteral">&quot;Error preparing SQL: (%i) %s\nSQL: \&quot;%s\&quot;\n&quot;</span>, rc, sqlite3_errmsg(db), pragma_sql);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordtype">int</span> found_ecu_col = 0;
    <span class="keywordflow">while</span>(SQLITE_ROW == sqlite3_step(stmt)) {
        <span class="keywordflow">if</span>(0 == strcmp(<span class="stringliteral">&quot;ecu&quot;</span>,sqlite3_column_text(stmt, 1))) {
            found_ecu_col = 1;
        }
    }

    sqlite3_finalize(stmt);

    <span class="keywordflow">if</span>(0 == found_ecu_col) {
        <span class="keywordtype">char</span> addcol_sql[256];
        snprintf(addcol_sql, <span class="keyword">sizeof</span>(addcol_sql), <span class="stringliteral">&quot;ALTER TABLE obd ADD ecu INTEGER DEFAULT 0&quot;</span>);

        <span class="keywordflow">if</span>(SQLITE_OK != sqlite3_exec(db, addcol_sql, NULL, NULL, &amp;errmsg)) {
            fprintf(stderr, <span class="stringliteral">&quot;ALTER db. SQL reported: %s\nSQL: \&quot;%s\&quot;\n&quot;</span>, errmsg, addcol_sql);
            sqlite3_free(errmsg);
            <span class="keywordflow">return</span> -1;
        } <span class="keywordflow">else</span> {
            printf(<span class="stringliteral">&quot;Ran ALTER sql: \&quot;%s\&quot;\n&quot;</span>, addcol_sql);
            retvalue++;
        }
    }

    <span class="keywordflow">return</span> retvalue;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afcfc30aae712bc373d4b9ce3e20bf153"></a><!-- doxytag: member="obdrepair.h::checktripends" ref="afcfc30aae712bc373d4b9ce3e20bf153" args="(sqlite3 *db)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="obdrepair_8h.html#afcfc30aae712bc373d4b9ce3e20bf153">checktripends</a> </td>
          <td>(</td>
          <td class="paramtype">sqlite3 *&#160;</td>
          <td class="paramname"><em>db</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Fix ends of trips. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if we changed nothing. -1 for error. &gt;0 if we changed stuff. </dd></dl>

<p>Definition at line <a class="el" href="obdrepair_8c_source.html#l00186">186</a> of file <a class="el" href="obdrepair_8c_source.html">obdrepair.c</a>.</p>
<div class="fragment"><pre class="fragment">                               {
    <span class="keywordtype">int</span> retvalue = 0;
    <span class="keywordtype">char</span> *errmsg = NULL;

    <span class="keyword">const</span> <span class="keywordtype">char</span> update_sql[] = <span class="stringliteral">&quot;UPDATE trip SET end=&quot;</span>
            <span class="stringliteral">&quot;(SELECT (t2.start-0.01) AS newstart from trip t2 WHERE trip.tripid=t2.tripid+1) &quot;</span>
        <span class="stringliteral">&quot;WHERE trip.end = -1&quot;</span>;

    <span class="keywordflow">if</span>(SQLITE_OK != sqlite3_exec(db, update_sql, NULL, NULL, &amp;errmsg)) {
        fprintf(stderr, <span class="stringliteral">&quot;UPDATE db. SQL reported: %s\nSQL: \&quot;%s\&quot;\n&quot;</span>, errmsg, update_sql);
        sqlite3_free(errmsg);
        <span class="keywordflow">return</span> -1;
    } <span class="keywordflow">else</span> {
        printf(<span class="stringliteral">&quot;Ran UPDATE sql: \&quot;%s\&quot;\n&quot;</span>, update_sql);
    }

    <span class="keywordflow">return</span> retvalue;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac54a1805666dc758af03ad791ba9c7fc"></a><!-- doxytag: member="obdrepair.h::checktripids" ref="ac54a1805666dc758af03ad791ba9c7fc" args="(sqlite3 *db, const char *table_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="obdrepair_8h.html#ac54a1805666dc758af03ad791ba9c7fc">checktripids</a> </td>
          <td>(</td>
          <td class="paramtype">sqlite3 *&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>table_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Fix trip ids. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if we changed nothing. -1 for error. &gt;0 if we changed stuff. </dd></dl>

<p>Definition at line <a class="el" href="obdrepair_8c_source.html#l00205">205</a> of file <a class="el" href="obdrepair_8c_source.html">obdrepair.c</a>.</p>
<div class="fragment"><pre class="fragment">                                                      {
    <span class="keywordtype">int</span> retvalue = 0;
    <span class="keywordtype">int</span> rc = 0;
    <span class="keywordtype">char</span> *errmsg = NULL;

    sqlite3_stmt *stmt;

    <span class="keywordtype">char</span> pragma_sql[256];
    snprintf(pragma_sql, <span class="keyword">sizeof</span>(pragma_sql), <span class="stringliteral">&quot;PRAGMA table_info(%s)&quot;</span>, table_name);

    <span class="keywordflow">if</span>(SQLITE_OK != (rc = sqlite3_prepare_v2(db, pragma_sql, -1, &amp;stmt, NULL))) {
        fprintf(stderr,<span class="stringliteral">&quot;Error preparing SQL: (%i) %s\nSQL: \&quot;%s\&quot;\n&quot;</span>, rc, sqlite3_errmsg(db), pragma_sql);
        <span class="keywordflow">return</span> -1;
    }

    <span class="keywordtype">int</span> found_trip_col = 0;
    <span class="keywordflow">while</span>(SQLITE_ROW == sqlite3_step(stmt)) {
        <span class="keywordflow">if</span>(0 == strcmp(<span class="stringliteral">&quot;trip&quot;</span>,sqlite3_column_text(stmt, 1))) {
            found_trip_col = 1;
        }
    }

    sqlite3_finalize(stmt);

    <span class="keywordflow">if</span>(0 == found_trip_col) {
        <span class="keywordtype">char</span> addcol_sql[256];
        snprintf(addcol_sql, <span class="keyword">sizeof</span>(addcol_sql), <span class="stringliteral">&quot;ALTER TABLE %s ADD trip INTEGER&quot;</span>, table_name);

        <span class="keywordflow">if</span>(SQLITE_OK != sqlite3_exec(db, addcol_sql, NULL, NULL, &amp;errmsg)) {
            fprintf(stderr, <span class="stringliteral">&quot;ALTER db. SQL reported: %s\nSQL: \&quot;%s\&quot;\n&quot;</span>, errmsg, addcol_sql);
            sqlite3_free(errmsg);
            <span class="keywordflow">return</span> -1;
        } <span class="keywordflow">else</span> {
            printf(<span class="stringliteral">&quot;Ran ALTER sql: \&quot;%s\&quot;\n&quot;</span>, addcol_sql);
        }

        sqlite3_stmt *trip_stmt;
        sqlite3_stmt *update_stmt;
        
        <span class="keyword">const</span> <span class="keywordtype">char</span> trip_sql[] = <span class="stringliteral">&quot;SELECT tripid, start, end FROM trip&quot;</span>;
        <span class="keywordtype">char</span> update_sql[1024];
        snprintf(update_sql, <span class="keyword">sizeof</span>(update_sql), <span class="stringliteral">&quot;UPDATE %s SET trip=? WHERE time&gt;? AND time&lt;?&quot;</span>, table_name);

        <span class="keywordflow">if</span>(SQLITE_OK != (rc = sqlite3_prepare_v2(db, update_sql, -1, &amp;update_stmt, NULL))) {
            fprintf(stderr, <span class="stringliteral">&quot;UPDATE db. SQL reported: %s\nSQL: \&quot;%s\&quot;\n&quot;</span>, sqlite3_errmsg(db), update_sql);
            <span class="keywordflow">return</span> -1;
        }

        <span class="keywordflow">if</span>(SQLITE_OK != (rc = sqlite3_prepare_v2(db, trip_sql, -1, &amp;trip_stmt, NULL))) {
            fprintf(stderr, <span class="stringliteral">&quot;Trip select: %s\nSQL: \&quot;%s\&quot;\n&quot;</span>, sqlite3_errmsg(db), trip_sql);
            <span class="keywordflow">return</span> -1;
        }

        <span class="keywordflow">while</span>(SQLITE_ROW == sqlite3_step(trip_stmt)) {
            printf(<span class="stringliteral">&quot;Updating trip; trip %i: %f&lt;time&lt;%f\n&quot;</span>,
                sqlite3_column_int(trip_stmt, 0),
                sqlite3_column_double(trip_stmt, 1),
                sqlite3_column_double(trip_stmt, 2));

            sqlite3_reset(update_stmt);
            sqlite3_bind_int(update_stmt, 1, sqlite3_column_int(trip_stmt, 0));
            sqlite3_bind_double(update_stmt, 2, sqlite3_column_double(trip_stmt, 1));
            sqlite3_bind_double(update_stmt, 3, sqlite3_column_double(trip_stmt, 2));
            sqlite3_step(update_stmt);
        
            retvalue++;
        }

        sqlite3_finalize(update_stmt);
        sqlite3_finalize(trip_stmt);
    }
    
    <span class="keywordflow">return</span> retvalue;
}
</pre></div>
</div>
</div>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Mon Jul 9 2012 14:11:07 for Logger by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
